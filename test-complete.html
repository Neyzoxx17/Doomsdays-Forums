<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Complet - Doomsday Forums</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            margin: 20px;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-title {
            color: #00ff00;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 255, 0, 0.05);
            border-left: 3px solid #00ff00;
        }
        
        .status-pass {
            color: #00ff00;
            font-weight: bold;
        }
        
        .status-fail {
            color: #ff0000;
            font-weight: bold;
        }
        
        .status-warning {
            color: #ffff00;
            font-weight: bold;
        }
        
        .log-container {
            background: #111;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
        }
        
        .log-error {
            color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }
        
        .log-warning {
            color: #ffff00;
            background: rgba(255, 255, 0, 0.1);
        }
        
        .log-success {
            color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }
        
        .log-info {
            color: #00ffff;
        }
        
        .btn-test {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn-test:hover {
            background: #00cc00;
            transform: scale(1.05);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            transition: width 0.3s;
            width: 0%;
        }
        
        .summary {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .summary-title {
            font-size: 1.6em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            text-align: center;
        }
        
        .stat-item {
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; color: #00ff00; font-size: 2em; margin-bottom: 30px;">
            üîß TEST COMPLET - DOOMSDAY FORUMS üîß
        </h1>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üìã Configuration et D√©pendances</div>
            <div class="test-item">
                <span id="test-firebase-sdk">Test Firebase SDK...</span>
            </div>
            <div class="test-item">
                <span id="test-security-module">Test Module S√©curit√©...</span>
            </div>
            <div class="test-item">
                <span id="test-browser-compat">Test Compatibilit√© Navigateur...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üîê Authentification</div>
            <div class="test-item">
                <span id="test-firebase-config">Test Configuration Firebase...</span>
            </div>
            <div class="test-item">
                <span id="test-auth-state">Test √âtat Authentification...</span>
            </div>
            <div class="test-item">
                <span id="test-login-function">Test Fonction Login...</span>
            </div>
            <div class="test-item">
                <span id="test-register-function">Test Fonction Register...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üí¨ Chat et Messagerie</div>
            <div class="test-item">
                <span id="test-chat-functions">Test Fonctions Chat...</span>
            </div>
            <div class="test-item">
                <span id="test-message-sending">Test Envoi Messages...</span>
            </div>
            <div class="test-item">
                <span id="test-message-listening">Test √âcoute Messages...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üè¢ Fonctionnalit√©s Forum</div>
            <div class="test-item">
                <span id="test-thread-creation">Test Cr√©ation Sujets...</span>
            </div>
            <div class="test-item">
                <span id="test-category-navigation">Test Navigation Cat√©gories...</span>
            </div>
            <div class="test-item">
                <span id="test-tag-system">Test Syst√®me Tags...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üë§ Profil et Personnalisation</div>
            <div class="test-item">
                <span id="test-profile-functions">Test Fonctions Profil...</span>
            </div>
            <div class="test-item">
                <span id="test-avatar-system">Test Syst√®me Avatars...</span>
            </div>
            <div class="test-item">
                <span id="test-notification-system">Test Syst√®me Notifications...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üîß Interface et Interactions</div>
            <div class="test-item">
                <span id="test-modal-functions">Test Fonctions Modales...</span>
            </div>
            <div class="test-item">
                <span id="test-ui-elements">Test √âl√©ments UI...</span>
            </div>
            <div class="test-item">
                <span id="test-event-handlers">Test Gestionnaires √âv√©nements...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üõ°Ô∏è S√©curit√© et Validation</div>
            <div class="test-item">
                <span id="test-input-sanitization">Test Sanitisation Entr√©es...</span>
            </div>
            <div class="test-item">
                <span id="test-rate-limiting">Test Rate Limiting...</span>
            </div>
            <div class="test-item">
                <span id="test-xss-protection">Test Protection XSS...</span>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">üìä Performance et Optimisation</div>
            <div class="test-item">
                <span id="test-loading-time">Test Temps Chargement...</span>
            </div>
            <div class="test-item">
                <span id="test-memory-usage">Test Utilisation M√©moire...</span>
            </div>
            <div class="test-item">
                <span id="test-error-handling">Test Gestion Erreurs...</span>
            </div>
        </div>
        
        <div class="log-container" id="logContainer">
            <div class="log-entry log-info">üöÄ D√©marrage des tests complets...</div>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="btn-test" onclick="runAllTests()">‚ñ∂ LANCER TOUS LES TESTS</button>
            <button class="btn-test" onclick="runQuickTest()">‚ö° TEST RAPIDE</button>
            <button class="btn-test" onclick="clearLogs()">üóëÔ∏è EFFACER LOGS</button>
            <button class="btn-test" onclick="exportReport()">üìÑ EXPORTER RAPPORT</button>
        </div>
        
        <div class="summary" id="summarySection" style="display: none;">
            <div class="summary-title">üìä R√âSUM√â DES TESTS</div>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalTests">0</div>
                    <div>Total Tests</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value status-pass" id="passedTests">0</div>
                    <div>‚úÖ R√©ussis</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value status-fail" id="failedTests">0</div>
                    <div>‚ùå √âchou√©s</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value status-warning" id="warningTests">0</div>
                    <div>‚ö†Ô∏è Avertissements</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB03b3P5Ec33HWCJVS7y6t6x7H-Nx6YsTc",
            authDomain: "doomsday-forums.firebaseapp.com",
            databaseURL: "https://doomsday-forums-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "doomsday-forums",
            storageBucket: "doomsday-forums.firebasestorage.app",
            messagingSenderId: "345452079794",
            appId: "1:345452079794:web:14b4978afb203a9d84b7ab",
            measurementId: "G-W1YDYYQKRR"
        };

        // Variables de test
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        let currentTestIndex = 0;
        const totalTests = 24;

        // Fonctions de logging
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateTestStatus(testId, status, message) {
            const element = document.getElementById(testId);
            if (element) {
                element.innerHTML = `<span class="status-${status}">${status.toUpperCase()}</span> ${message}`;
            }
            
            testResults.total++;
            if (status === 'pass') testResults.passed++;
            else if (status === 'fail') testResults.failed++;
            else if (status === 'warning') testResults.warnings++;
            
            updateProgress();
        }

        function updateProgress() {
            const progress = (testResults.total / totalTests) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            if (testResults.total === totalTests) {
                showSummary();
            }
        }

        function showSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('warningTests').textContent = testResults.warnings;
            document.getElementById('summarySection').style.display = 'block';
            
            log('üìä Tests termin√©s!', 'success');
            log(`‚úÖ R√©ussis: ${testResults.passed}`, 'success');
            log(`‚ùå √âchou√©s: ${testResults.failed}`, testResults.failed > 0 ? 'error' : 'success');
            log(`‚ö†Ô∏è Avertissements: ${testResults.warnings}`, testResults.warnings > 0 ? 'warning' : 'success');
        }

        // Tests de configuration
        async function testFirebaseSDK() {
            try {
                if (typeof firebase !== 'undefined') {
                    updateTestStatus('test-firebase-sdk', 'pass', 'Firebase SDK charg√©');
                    log('‚úÖ Firebase SDK disponible', 'success');
                    return true;
                } else {
                    updateTestStatus('test-firebase-sdk', 'fail', 'Firebase SDK non trouv√©');
                    log('‚ùå Firebase SDK non disponible', 'error');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-firebase-sdk', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur Firebase SDK: ${error.message}`, 'error');
                return false;
            }
        }

        async function testSecurityModule() {
            try {
                // Test si les fonctions de s√©curit√© existent
                const securityFunctions = ['sanitizeInput', 'validateEmail', 'validatePassword'];
                let missingFunctions = [];
                
                for (const func of securityFunctions) {
                    if (typeof window[func] !== 'function') {
                        missingFunctions.push(func);
                    }
                }
                
                if (missingFunctions.length === 0) {
                    updateTestStatus('test-security-module', 'pass', 'Module s√©curit√© complet');
                    log('‚úÖ Module s√©curit√© complet', 'success');
                    return true;
                } else {
                    updateTestStatus('test-security-module', 'warning', `Fonctions manquantes: ${missingFunctions.join(', ')}`);
                    log(`‚ö†Ô∏è Fonctions s√©curit√© manquantes: ${missingFunctions.join(', ')}`, 'warning');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-security-module', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur module s√©curit√©: ${error.message}`, 'error');
                return false;
            }
        }

        async function testBrowserCompatibility() {
            try {
                const features = {
                    'localStorage': typeof Storage !== 'undefined',
                    'sessionStorage': typeof sessionStorage !== 'undefined',
                    'fetch': typeof fetch !== 'undefined',
                    'promises': typeof Promise !== 'undefined',
                    'arrowFunctions': (() => { try { eval('() => {}'); return true; } catch { return false; } })(),
                    'templateLiterals': (() => { try { eval('`test`'); return true; } catch { return false; } })()
                };
                
                const unsupported = Object.keys(features).filter(key => !features[key]);
                
                if (unsupported.length === 0) {
                    updateTestStatus('test-browser-compat', 'pass', 'Navigateur compatible');
                    log('‚úÖ Navigateur enti√®rement compatible', 'success');
                    return true;
                } else {
                    updateTestStatus('test-browser-compat', 'warning', `Fonctionnalit√©s non support√©es: ${unsupported.join(', ')}`);
                    log(`‚ö†Ô∏è Fonctionnalit√©s navigateur non support√©es: ${unsupported.join(', ')}`, 'warning');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-browser-compat', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur compatibilit√©: ${error.message}`, 'error');
                return false;
            }
        }

        // Tests d'authentification
        async function testFirebaseConfig() {
            try {
                firebase.initializeApp(firebaseConfig);
                const database = firebase.database();
                const auth = firebase.auth();
                
                updateTestStatus('test-firebase-config', 'pass', 'Firebase initialis√©');
                log('‚úÖ Firebase correctement initialis√©', 'success');
                return true;
            } catch (error) {
                updateTestStatus('test-firebase-config', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur initialisation Firebase: ${error.message}`, 'error');
                return false;
            }
        }

        async function testAuthState() {
            try {
                const auth = firebase.auth();
                
                return new Promise((resolve) => {
                    const unsubscribe = auth.onAuthStateChanged((user) => {
                        unsubscribe();
                        updateTestStatus('test-auth-state', 'pass', user ? 'Utilisateur connect√©' : 'Aucun utilisateur');
                        log(`‚úÖ √âtat authentification: ${user ? 'Connect√©' : 'Non connect√©'}`, 'success');
                        resolve(true);
                    }, (error) => {
                        unsubscribe();
                        updateTestStatus('test-auth-state', 'fail', `Erreur: ${error.message}`);
                        log(`‚ùå Erreur √©tat auth: ${error.message}`, 'error');
                        resolve(false);
                    });
                    
                    // Timeout apr√®s 5 secondes
                    setTimeout(() => {
                        unsubscribe();
                        updateTestStatus('test-auth-state', 'warning', 'Timeout - Pas de r√©ponse');
                        log('‚ö†Ô∏è Timeout √©tat authentification', 'warning');
                        resolve(false);
                    }, 5000);
                });
            } catch (error) {
                updateTestStatus('test-auth-state', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur test √©tat auth: ${error.message}`, 'error');
                return false;
            }
        }

        // Tests de chat
        async function testChatFunctions() {
            try {
                const chatFunctions = ['sendMessage', 'addMessage', 'handleChatKeyPress'];
                let missingFunctions = [];
                
                for (const func of chatFunctions) {
                    if (typeof window[func] !== 'function') {
                        missingFunctions.push(func);
                    }
                }
                
                if (missingFunctions.length === 0) {
                    updateTestStatus('test-chat-functions', 'pass', 'Fonctions chat compl√®tes');
                    log('‚úÖ Fonctions chat disponibles', 'success');
                    return true;
                } else {
                    updateTestStatus('test-chat-functions', 'warning', `Fonctions manquantes: ${missingFunctions.join(', ')}`);
                    log(`‚ö†Ô∏è Fonctions chat manquantes: ${missingFunctions.join(', ')}`, 'warning');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-chat-functions', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur fonctions chat: ${error.message}`, 'error');
                return false;
            }
        }

        // Tests forum
        async function testThreadCreation() {
            try {
                if (typeof createThread === 'function') {
                    updateTestStatus('test-thread-creation', 'pass', 'Fonction cr√©ation sujet disponible');
                    log('‚úÖ Fonction cr√©ation sujet disponible', 'success');
                    return true;
                } else {
                    updateTestStatus('test-thread-creation', 'warning', 'Fonction cr√©ation sujet non trouv√©e');
                    log('‚ö†Ô∏è Fonction cr√©ation sujet non disponible', 'warning');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-thread-creation', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur cr√©ation sujet: ${error.message}`, 'error');
                return false;
            }
        }

        // Tests UI
        async function testModalFunctions() {
            try {
                const modalFunctions = ['openModal', 'closeModal'];
                let missingFunctions = [];
                
                for (const func of modalFunctions) {
                    if (typeof window[func] !== 'function') {
                        missingFunctions.push(func);
                    }
                }
                
                if (missingFunctions.length === 0) {
                    updateTestStatus('test-modal-functions', 'pass', 'Fonctions modales compl√®tes');
                    log('‚úÖ Fonctions modales disponibles', 'success');
                    return true;
                } else {
                    updateTestStatus('test-modal-functions', 'warning', `Fonctions manquantes: ${missingFunctions.join(', ')}`);
                    log(`‚ö†Ô∏è Fonctions modales manquantes: ${missingFunctions.join(', ')}`, 'warning');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-modal-functions', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur fonctions modales: ${error.message}`, 'error');
                return false;
            }
        }

        // Tests performance
        async function testLoadingTime() {
            try {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                const loadTimeSeconds = (loadTime / 1000).toFixed(2);
                
                if (loadTimeSeconds < 3) {
                    updateTestStatus('test-loading-time', 'pass', `Chargement: ${loadTimeSeconds}s`);
                    log(`‚úÖ Temps de chargement excellent: ${loadTimeSeconds}s`, 'success');
                    return true;
                } else if (loadTimeSeconds < 5) {
                    updateTestStatus('test-loading-time', 'warning', `Chargement: ${loadTimeSeconds}s`);
                    log(`‚ö†Ô∏è Temps de chargement moyen: ${loadTimeSeconds}s`, 'warning');
                    return false;
                } else {
                    updateTestStatus('test-loading-time', 'fail', `Chargement lent: ${loadTimeSeconds}s`);
                    log(`‚ùå Temps de chargement lent: ${loadTimeSeconds}s`, 'error');
                    return false;
                }
            } catch (error) {
                updateTestStatus('test-loading-time', 'fail', `Erreur: ${error.message}`);
                log(`‚ùå Erreur test chargement: ${error.message}`, 'error');
                return false;
            }
        }

        // Fonctions de test principal
        async function runAllTests() {
            log('üöÄ D√©marrage de tous les tests...', 'info');
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('summarySection').style.display = 'none';
            
            const tests = [
                testFirebaseSDK,
                testSecurityModule,
                testBrowserCompatibility,
                testFirebaseConfig,
                testAuthState,
                testChatFunctions,
                testThreadCreation,
                testModalFunctions,
                testLoadingTime
            ];
            
            for (const test of tests) {
                try {
                    await test();
                    await new Promise(resolve => setTimeout(resolve, 500)); // Pause entre tests
                } catch (error) {
                    log(`‚ùå Erreur inattendue: ${error.message}`, 'error');
                }
            }
            
            log('üèÅ Tous les tests termin√©s!', 'info');
        }

        async function runQuickTest() {
            log('‚ö° D√©marrage test rapide...', 'info');
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('summarySection').style.display = 'none';
            
            await testFirebaseSDK();
            await testFirebaseConfig();
            await testLoadingTime();
            
            log('‚ö° Test rapide termin√©!', 'info');
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '<div class="log-entry log-info">üóëÔ∏è Logs effac√©s...</div>';
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('summarySection').style.display = 'none';
            document.getElementById('progressBar').style.width = '0%';
            
            // R√©initialiser les statuts
            const testElements = document.querySelectorAll('[id^="test-"]');
            testElements.forEach(element => {
                element.innerHTML = 'En attente...';
            });
        }

        function exportReport() {
            const logs = document.getElementById('logContainer').innerText;
            const summary = `
RAPPORT DE TEST - DOOMSDAY FORUMS
Date: ${new Date().toLocaleString()}
Total Tests: ${testResults.total}
R√©ussis: ${testResults.passed}
√âchou√©s: ${testResults.failed}
Avertissements: ${testResults.warnings}

LOGS:
${logs}
            `;
            
            const blob = new Blob([summary], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-report-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('üìÑ Rapport export√© avec succ√®s', 'success');
        }

        // D√©marrage automatique au chargement
        window.addEventListener('load', () => {
            log('üîß Page de test charg√©e', 'info');
            log('üëÜ Cliquez sur "LANCER TOUS LES TESTS" pour commencer', 'info');
        });
    </script>
</body>
</html>
