<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="apple-mobile-web-app-title" content="Doomsday Forums">
    <title>Doomsday Forums</title>
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #1a0505 50%, #0a0a0a 75%, #000000 100%);
            background-attachment: fixed;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
            overflow-x: hidden;
        }
        
        /* Animated Background Particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 0, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes backgroundShift {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-20px) translateY(-10px); }
            50% { transform: translateX(10px) translateY(20px); }
            75% { transform: translateX(-10px) translateY(-5px); }
        }
        
        /* Enhanced Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000, #1a0505);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(220, 20, 60, 0.2);
            border-top: 3px solid #dc143c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #dc143c;
            font-size: 1.2rem;
            font-weight: 600;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        /* Enhanced Header */
        .main-header {
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(26,5,5,0.8));
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(220, 20, 60, 0.3);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(220, 20, 60, 0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #dc143c, #ff6b6b, #dc143c);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(220, 20, 60, 0.5);
        }
        
        @keyframes logoGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #dc143c, #8b0000);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            animation: iconRotate 10s linear infinite;
        }
        
        @keyframes iconRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Enhanced Navigation */
        .main-nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-link {
            color: #ffffff;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 20, 60, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .nav-link:hover::before {
            left: 100%;
        }
        
        .nav-link:hover {
            background: rgba(220, 20, 60, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.2);
        }
        
        .nav-link.active {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.2), rgba(220, 20, 60, 0.1));
            border: 1px solid rgba(220, 20, 60, 0.3);
        }
        
        /* Account Section */
        .account-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(220, 20, 60, 0.1);
            padding: 8px 15px;
            border-radius: 25px;
            border: 1px solid rgba(220, 20, 60, 0.2);
            transition: all 0.3s ease;
        }
        
        .user-info:hover {
            background: rgba(220, 20, 60, 0.15);
            transform: scale(1.02);
        }
        
        .user-avatar-small {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc143c, #8b0000);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .username-display {
            font-weight: 600;
            color: #ffffff;
            font-size: 0.9rem;
        }
        
        .user-role-badge {
            background: linear-gradient(135deg, #dc143c, #8b0000);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn-login, .btn-register {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.8), rgba(220, 20, 60, 0.6));
            color: white;
            border: 1px solid rgba(220, 20, 60, 0.5);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-login:hover, .btn-register:hover {
            background: linear-gradient(135deg, rgba(220, 20, 60, 1), rgba(220, 20, 60, 0.8));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }
        
        .btn-register {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.8), rgba(34, 139, 34, 0.6));
            border: 1px solid rgba(34, 139, 34, 0.5);
        }
        
        .btn-register:hover {
            background: linear-gradient(135deg, rgba(34, 139, 34, 1), rgba(34, 139, 34, 0.8));
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.3);
        }
        
        /* Enhanced Hero Section */
        .hero-section-enhanced {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 40%, #1a0505 60%, #0a0a0a 80%, #000000 100%);
        }
        
        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .hero-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 0, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
            animation: particlesFloat 15s ease-in-out infinite;
        }
        
        .hero-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(220, 20, 60, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(220, 20, 60, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes particlesFloat {
            0%, 100% { transform: translateX(0) translateY(0); }
            33% { transform: translateX(-30px) translateY(-20px); }
            66% { transform: translateX(20px) translateY(30px); }
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        .hero-content {
            position: relative;
            z-index: 10;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
        }
        
        .hero-text {
            animation: slideInLeft 1s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 20px;
        }
        
        .hero-title-main {
            display: block;
            color: #ffffff;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .hero-title-brand {
            display: block;
            background: linear-gradient(135deg, #dc143c, #ff6b6b, #dc143c);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: brandGlow 3s ease-in-out infinite;
        }
        
        @keyframes brandGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }
        
        .hero-title-sub {
            display: block;
            color: #cccccc;
            font-size: 1.8rem;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            color: #aaaaaa;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .hero-highlight {
            color: #dc143c;
            font-weight: 600;
            position: relative;
        }
        
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(220, 20, 60, 0.05);
            border: 1px solid rgba(220, 20, 60, 0.1);
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(220, 20, 60, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.2);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 900;
            color: #dc143c;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #aaaaaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .hero-actions {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .btn-hero-primary, .btn-hero-secondary {
            position: relative;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-hero-primary {
            background: linear-gradient(135deg, #dc143c, #8b0000);
            color: white;
        }
        
        .btn-hero-secondary {
            background: transparent;
            color: #dc143c;
            border: 2px solid #dc143c;
        }
        
        .btn-glow {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-hero-primary:hover .btn-glow,
        .btn-hero-secondary:hover .btn-glow {
            left: 100%;
        }
        
        .btn-hero-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.4);
        }
        
        .btn-hero-secondary:hover {
            background: rgba(220, 20, 60, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.2);
        }
        
        .hero-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            animation: slideInRight 1s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .hero-shield {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .shield-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid rgba(220, 20, 60, 0.3);
            border-radius: 50%;
            animation: ringPulse 2s ease-in-out infinite;
        }
        
        @keyframes ringPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
        
        .shield-core {
            font-size: 4rem;
            animation: coreRotate 10s linear infinite;
        }
        
        @keyframes coreRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .shield-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(220, 20, 60, 0.1) 0%, transparent 70%);
            animation: particlesRotate 15s linear infinite;
        }
        
        @keyframes particlesRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hero-scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #aaaaaa;
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }
        
        .scroll-arrow {
            width: 20px;
            height: 20px;
            border-right: 2px solid #dc143c;
            border-bottom: 2px solid #dc143c;
            transform: rotate(45deg);
            margin: 0 auto 10px;
        }
        
        /* Enhanced Toast Notifications */
        .toast-notification {
            position: relative;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid rgba(220, 20, 60, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .toast-notification.toast-success {
            border-color: rgba(34, 139, 34, 0.5);
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.1), rgba(34, 139, 34, 0.05));
        }
        
        .toast-notification.toast-error {
            border-color: rgba(220, 20, 60, 0.5);
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.1), rgba(220, 20, 60, 0.05));
        }
        
        .toast-notification.toast-warning {
            border-color: rgba(255, 165, 0, 0.5);
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.1), rgba(255, 165, 0, 0.05));
        }
        
        .toast-notification.toast-info {
            border-color: rgba(30, 144, 255, 0.5);
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.1), rgba(30, 144, 255, 0.05));
        }
        
        .toast-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
            color: #ffffff;
            font-weight: 500;
        }
        
        .toast-time {
            font-size: 0.7rem;
            color: #aaaaaa;
            flex-shrink: 0;
        }
        
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, #dc143c, #ff6b6b);
            border-radius: 0 0 12px 12px;
            animation: progressShrink 3s linear;
        }
        
        @keyframes progressShrink {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .toast-notification.toast-removing {
            animation: slideOutRight 0.3s ease-out;
            opacity: 0;
            transform: translateX(100%);
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        /* Responsive Navigation */
        @media (max-width: 768px) {
            .main-nav {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.95);
                backdrop-filter: blur(10px);
                flex-direction: column;
                padding: 20px;
                border-radius: 0 0 15px 15px;
            }
            
            .main-nav.mobile-open {
                display: flex;
            }
            
            .mobile-menu-toggle {
                display: block;
                background: none;
                border: none;
                color: #dc143c;
                font-size: 1.5rem;
                cursor: pointer;
            }
            
            .toast-notification {
                min-width: 250px;
                max-width: calc(100vw - 40px);
            }
        }
        
        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none;
            }
        }

        /* Notification System */
        .notification-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #dc143c, #b91c3c);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.9rem;
            z-index: 1000;
            transition: all 0.3s;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.3);
        }

        .notification-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 12px rgba(220, 20, 60, 0.4);
        }

        .notification-btn.ring {
            animation: ring 2s ease-in-out infinite;
        }

        @keyframes ring {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(1.1); }
            30% { transform: scale(1); }
            40% { transform: scale(1.1); }
            50% { transform: scale(1); }
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            animation: pulse 2s infinite;
            border: 2px solid #1a1a1a;
        }

        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid #dc143c;
            border-radius: 15px;
            padding: 20px;
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 999;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1001;
            pointer-events: none;
        }

        .toast-notification {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid #dc143c;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            min-width: 300px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8);
            animation: slideInRight 0.3s ease-out;
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toast-notification:hover {
            transform: translateX(-5px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.4);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes blueLightning {
            0% {
                box-shadow: 0 0 5px rgba(0, 102, 255, 0.5);
                background: linear-gradient(45deg, #0066cc, #00aaff);
            }
            25% {
                box-shadow: 0 0 20px rgba(0, 102, 255, 0.8), 0 0 30px rgba(0, 170, 255, 0.6);
                background: linear-gradient(45deg, #0088ff, #00ccff);
            }
            50% {
                box-shadow: 0 0 5px rgba(0, 102, 255, 0.5);
                background: linear-gradient(45deg, #0066cc, #00aaff);
            }
            75% {
                box-shadow: 0 0 25px rgba(0, 102, 255, 1), 0 0 40px rgba(0, 170, 255, 0.8);
                background: linear-gradient(45deg, #0099ff, #00ddff);
            }
            100% {
                box-shadow: 0 0 5px rgba(0, 102, 255, 0.5);
                background: linear-gradient(45deg, #0066cc, #00aaff);
            }
        }

        .toast-content {
            color: #ffffff;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .toast-time {
            color: #888;
            font-size: 0.7rem;
        }

        .bell-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            position: relative;
        }

        .bell-icon::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            border: 3px solid currentColor;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            border-bottom: none;
            transform: rotate(0deg);
            transition: transform 0.3s;
        }

        .bell-icon::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: currentColor;
            border-radius: 50%;
        }

        .notification-btn:hover .bell-icon::before {
            transform: rotate(15deg);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .notification-title {
            color: #dc143c;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .clear-notifications {
            background: #333;
            color: #ccc;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .clear-notifications:hover {
            background: #444;
            color: #dc143c;
        }

        .notification-item {
            background: #222;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .notification-item:hover {
            background: #333;
            border-color: #dc143c;
        }

        .notification-item.unread {
            border-color: #dc143c;
            background: rgba(220, 20, 60, 0.1);
        }

        .notification-content {
            color: #ffffff;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .notification-time {
            color: #888;
            font-size: 0.7rem;
        }

        .notification-empty {
            text-align: center;
            color: #888;
            padding: 20px;
        }

        /* Header */
        header {
            position: relative;
            padding: 20px 40px;
        }

        .logo-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: #ff0000;
        }


        .account-buttons {
            display: flex;
            gap: 6px;
            position: absolute;
            top: 20px;
            right: 40px;
            align-items: center;
            flex-wrap: nowrap;
        }

        .notification-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.9), rgba(255, 0, 0, 0.8));
            color: #ffffff;
            border: 2px solid #dc143c;
            padding: 6px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
            backdrop-filter: blur(10px);
        }

        .notification-btn:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.95), rgba(220, 20, 60, 0.9));
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.6);
            border-color: #ff0000;
        }

        .notification-btn:active {
            transform: translateY(0) scale(0.98);
        }

        .notification-btn.pulse {
            animation: notificationPulse 2s infinite;
        }

        @keyframes notificationPulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(220, 20, 60, 0.8);
            }
        }

        .btn-account:hover {
            background: #dc143c;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.4);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            position: absolute;
            top: 20px;
            right: 40px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 2px solid #ff0000;
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* #STYLES FORUM - CRÃ‰ATION DE SUJETS# */
        .create-thread-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .create-thread-container .form-group {
            margin-bottom: 15px;
        }

        .create-thread-container label {
            display: block;
            margin-bottom: 5px;
            color: #ffffff;
            font-weight: bold;
        }

        .create-thread-container input,
        .create-thread-container select,
        .create-thread-container textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            background: #222;
            color: white;
            border-radius: 5px;
            font-family: inherit;
        }

        .create-thread-container textarea {
            resize: vertical;
            min-height: 120px;
        }

        .create-thread-container .btn-primary {
            background: linear-gradient(45deg, #dc143c, #ff0000);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .create-thread-container .btn-primary:hover {
            background: linear-gradient(45deg, #ff0000, #ff3333);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
        }

        /* #STYLES FORUM - TAGS# */
        .thread-tags {
            margin-top: 5px;
        }

        .tag {
            display: inline-block;
            background: rgba(220, 20, 60, 0.2);
            color: #dc143c;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 5px;
            border: 1px solid rgba(220, 20, 60, 0.3);
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-username {
            color: #ffffff;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .user-role {
            color: #ff0000;
            font-size: 0.8rem;
        }

        .btn-logout {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
            border: 1px solid #ff0000;
            padding: 4px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #ff0000;
            color: white;
        }

        .btn {
            background-color: #dc143c;
            color: #ffffff;
            border: 2px solid #dc143c;
            padding: 4px 10px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 3px;
            text-decoration: none;
            display: inline-block;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            min-height: 28px;
            min-width: 28px;
        }

        .btn:hover {
            background-color: #b91c3c;
            border-color: #b91c3c;
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(220, 20, 60, 0.4);
        }

        /* Main Content */
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 120px 20px 40px;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero-title {
            font-size: 4rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 5px;
            animation: fadeInDown 1s ease-out;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: #cccccc;
            margin-bottom: 40px;
            animation: fadeInUp 1s ease-out 0.5s both;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Discussion Thread Section */
        .discussion-section {
            width: 100%;
            max-width: 800px;
            background-color: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            border-radius: 10px;
            padding: 30px;
            animation: fadeIn 1s ease-out 1s both;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #ff0000;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .thread-list {
            list-style: none;
        }

        .thread-item {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid #ff0000;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .thread-item:hover {
            background-color: rgba(255, 0, 0, 0.2);
            transform: translateX(5px);
        }

        .thread-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .thread-meta {
            font-size: 0.9rem;
            color: #cccccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .thread-author {
            color: #dc143c;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }

        .thread-author:hover {
            color: #ff6666;
            text-decoration: underline;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .category-card {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 1px solid #dc143c;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(220, 20, 60, 0.3);
            border-color: #ff6666;
        }

        .category-icon {
            font-size: 2.5rem;
            color: #dc143c;
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
        }

        .category-description {
            color: #ccc;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .category-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.8rem;
            color: #888;
        }

        .category-stats span {
            background: #333;
            padding: 4px 8px;
            border-radius: 10px;
        }

        .thread-stats {
            display: flex;
            gap: 20px;
            font-size: 0.8rem;
        }

        /* Chat Section */
        .chat-section {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 600px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border: 2px solid #dc143c;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(220, 20, 60, 0.3);
            display: flex;
            flex-direction: column;
            z-index: 1001;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .chat-section:hover {
            box-shadow: 0 15px 40px rgba(220, 20, 60, 0.4);
            transform: translateY(-2px);
        }

        .chat-hidden {
            height: 60px;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #dc143c, #b91c3c);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-radius: 13px 13px 0 0;
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .chat-header:hover::before {
            left: 100%;
        }

        .chat-header span:first-child {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-header span:first-child::before {
            content: 'ðŸ’¬';
            font-size: 1.2rem;
        }

        .online-users {
            padding: 12px 20px;
            background: rgba(220, 20, 60, 0.1);
            border-bottom: 1px solid rgba(220, 20, 60, 0.3);
            font-size: 0.9rem;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

    

        .online-count {
            color: #dc143c;
            font-weight: bold;
            font-size: 1rem;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #dc143c;
            border-radius: 3px;
        }

        .message {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 15px;
            animation: messageSlideIn 0.3s ease-out;
            transition: all 0.3s ease;
            position: relative;
        }

        .message:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-2px);
            border-color: rgba(220, 20, 60, 0.3);
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .message-author {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .message-author .username {
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .message-author .username:hover {
            text-decoration: underline;
            transform: scale(1.05);
        }

        .message-author .username.admin {
            color: #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
            animation: lightning 1.5s infinite;
            position: relative;
        }

        .message-author .username.admin::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 0, 0.3), transparent);
            animation: lightningStrike 2s infinite;
            z-index: -1;
        }

        .message-author .username.moderator {
            color: #ff6600;
            text-shadow: 0 0 8px rgba(255, 102, 0, 0.8);
            animation: lightning 2s infinite;
            position: relative;
        }

        .message-author .username.moderator::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, transparent, rgba(255, 200, 0, 0.2), transparent);
            animation: lightningStrike 2.5s infinite;
            z-index: -1;
        }

        @keyframes lightning {
            0%, 100% { 
                text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
                filter: brightness(1);
            }
            10% { 
                text-shadow: 0 0 30px currentColor, 0 0 50px currentColor, 0 0 70px currentColor;
                filter: brightness(2);
            }
            20% { 
                text-shadow: 0 0 5px currentColor;
                filter: brightness(0.5);
            }
            30% { 
                text-shadow: 0 0 40px currentColor, 0 0 60px currentColor, 0 0 80px currentColor;
                filter: brightness(2.5);
            }
            40% { 
                text-shadow: 0 0 15px currentColor;
                filter: brightness(1.2);
            }
            50% { 
                text-shadow: 0 0 25px currentColor, 0 0 35px currentColor;
                filter: brightness(1.8);
            }
            60% { 
                text-shadow: 0 0 8px currentColor;
                filter: brightness(0.8);
            }
            70% { 
                text-shadow: 0 0 45px currentColor, 0 0 65px currentColor;
                filter: brightness(2.2);
            }
            80% { 
                text-shadow: 0 0 12px currentColor;
                filter: brightness(1.1);
            }
            90% { 
                text-shadow: 0 0 35px currentColor, 0 0 55px currentColor;
                filter: brightness(1.9);
            }
        }

        @keyframes lightningStrike {
            0%, 100% { 
                opacity: 0;
                transform: scale(0.8);
            }
            5% { 
                opacity: 0.8;
                transform: scale(1.1);
            }
            10% { 
                opacity: 1;
                transform: scale(1.2);
            }
            15% { 
                opacity: 0.3;
                transform: scale(0.9);
            }
            20% { 
                opacity: 0.9;
                transform: scale(1.15);
            }
            25% { 
                opacity: 0;
                transform: scale(0.8);
            }
            100% { 
                opacity: 0;
                transform: scale(0.8);
            }
        }

        .message-text .mention {
            color: #00ff00;
            font-weight: bold;
            cursor: pointer;
            background: rgba(0, 255, 0, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .message-text .mention:hover {
            background: rgba(0, 255, 0, 0.2);
            transform: scale(1.05);
        }

        .reply-indicator {
            background: rgba(255, 255, 0, 0.1);
            border-left: 3px solid #ffff00;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #cccccc;
        }

        .reply-to-user {
            color: #ffff00;
            font-weight: bold;
            cursor: pointer;
        }

        .color-picker {
            position: absolute;
            top: 100%;
            left: 0;
            background: #333;
            border: 1px solid #666;
            border-radius: 8px;
            padding: 8px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .color-picker.show {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 4px;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: #fff;
        }

        .color-option.selected {
            border-color: #ffff00;
            box-shadow: 0 0 8px currentColor;
        }

        .message-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #dc143c, #b91c3c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            border: 2px solid #333;
            object-fit: cover;
            overflow: hidden;
        }

        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message-text {
            color: #ffffff;
            line-height: 1.4;
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .message-time {
            color: #888;
            font-size: 0.75rem;
            text-align: right;
            font-style: italic;
        }

        .chat-input-container {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(220, 20, 60, 0.3);
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: stretch;
        }

        .chat-icon-bar {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .chat-icon-bar::-webkit-scrollbar {
            display: none;
        }

        .chat-icon-btn {
            background: rgba(220, 20, 60, 0.2);
            border: 1px solid rgba(220, 20, 60, 0.3);
            border-radius: 6px;
            padding: 4px 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-icon-btn:hover {
            background: rgba(220, 20, 60, 0.4);
            transform: scale(1.1);
        }

        .chat-icon-btn:active {
            transform: scale(0.95);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(220, 20, 60, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #dc143c;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.3);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-send-btn {
            background: linear-gradient(135deg, #dc143c, #b91c3c);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 60px;
            font-size: 0.8rem;
        }

        .chat-send-btn:hover {
            background: linear-gradient(135deg, #ff1744, #d50000);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.4);
        }

        .chat-send-btn:active {
            transform: scale(0.95);
        }

        .avatar-option:hover {
            border-color: #ff0000;
            transform: scale(1.05);
        }

        .avatar-option.selected {
            border-color: #ff0000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 35px;
            height: 35px;
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3);
        }

        .chat-toggle:hover {
            background-color: #cc0000;
            transform: scale(1.1);
        }

        .chat-toggle::before {
            content: 'ðŸ’¬';
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
            }

            .logo {
                font-size: 2rem;
            }

            .account-buttons {
                position: static;
                justify-content: center;
                margin-top: 15px;
                flex-wrap: wrap;
            }

            .btn-account {
                font-size: 0.6rem;
                padding: 3px 6px;
                margin: 1px;
            }

            .auth-buttons {
                position: static;
                justify-content: center;
                margin-top: 20px;
            }

            .user-profile {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 15px;
                gap: 10px;
            }

            .user-username {
                font-size: 1rem;
                cursor: pointer;
                transition: color 0.3s;
            }

            .user-username:hover {
                color: #ff6666;
            }

            .user-avatar {
                cursor: pointer;
                transition: transform 0.3s;
            }

            .user-avatar:hover {
                transform: scale(1.1);
            }

            .hero-title {
                font-size: 2rem;
                letter-spacing: 2px;
            }

            .hero-subtitle {
                font-size: 1rem;
                padding: 0 20px;
            }

            .discussion-section {
                padding: 20px 15px;
                margin: 0 10px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .thread-item {
                padding: 12px;
                margin-bottom: 10px;
            }

            .thread-title {
                font-size: 1rem;
            }

            .thread-stats {
                flex-direction: column;
                gap: 5px;
                font-size: 0.75rem;
            }

            .chat-section {
                width: 100%;
                height: 100vh;
                bottom: 0;
                right: 0;
                border-radius: 0;
                max-width: 100%;
            }

            .chat-toggle {
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .chat-header {
                padding: 15px;
                font-size: 1.1rem;
            }

            .role-selector {
                padding: 8px 15px;
            }

            .role-selector select {
                font-size: 0.8rem;
                padding: 6px 10px;
            }

            .chat-messages {
                padding: 10px;
            }

            .message {
                padding: 10px;
                margin-bottom: 8px;
            }

            .message-author {
                font-size: 0.85rem;
            }

            .message-text {
                font-size: 0.9rem;
            }

            .chat-input-container {
                padding: 10px 15px;
                gap: 8px;
            }

            .chat-input {
                font-size: 1rem;
                padding: 12px;
            }

            .chat-send-btn {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .modal-content {
                width: 95%;
                margin: 20px;
                padding: 20px;
            }

            .modal-title {
                font-size: 1.3rem;
            }

            .form-group input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }

            .hero-title {
                font-size: 1.8rem;
            }

            .auth-buttons {
                flex-direction: column;
                width: 100%;
            }

            .btn {
                width: 100%;
                margin-bottom: 5px;
            }

            .discussion-section {
                margin: 0 5px;
                padding: 15px 10px;
            }

            .chat-toggle {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        /* iPhone X and newer safe area */
        @supports (padding: max(0px)) {
            .chat-section {
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
            
            .chat-toggle {
                bottom: max(20px, env(safe-area-inset-bottom));
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background-color: #000000;
            border: 2px solid #ff0000;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #ff0000;
            font-size: 1.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: #ff0000;
            font-size: 2rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Enhanced Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Chargement de Doomsday Forums...</div>
    </div>

    <!-- Enhanced Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">ðŸ›¡ï¸</div>
                <h1 class="logo">Doomsday Forums</h1>
            </div>
            
            <!-- Enhanced Navigation -->
            <nav class="main-nav" id="mainNav">
                <a href="index.html" class="nav-link active">ðŸ  Accueil</a>
                <a href="category-posts.html" class="nav-link">ðŸ“‚ Forums</a>
                <a href="profile.html" class="nav-link">ðŸ‘¤ Profil</a>
                <a href="messages.html" class="nav-link">ðŸ’¬ Messages</a>
                <a href="admin.html" class="nav-link admin-only" style="display: none;">âš™ï¸ Admin</a>
            </nav>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">â˜°</button>
            
            <!-- Account Section -->
            <div class="account-section" id="accountSection">
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar-small" id="userAvatarSmall">ðŸ‘¤</div>
                    <span class="username-display" id="usernameDisplay">Utilisateur</span>
                    <div class="user-role-badge" id="userRoleBadge">Member</div>
                </div>
                
                <div class="auth-buttons" id="authButtons">
                    <button class="btn btn-login" onclick="openModal('loginModal')">ðŸ” Connexion</button>
                    <button class="btn btn-register" onclick="openModal('registerModal')">ðŸ“ Inscription</button>
                </div>
            </div>
        </div>
    </header>
        </div>
        
        <!-- #SECTION PROFIL UTILISATEUR# -->
        <!-- Profil utilisateur avec notification intÃ©grÃ©e -->
        <div class="user-profile" id="userProfile" style="display: none;">
            <div class="user-avatar" onclick="window.location.href='profile.html'" style="cursor: pointer;">
                <img id="userAvatar" src="https://picsum.photos/seed/default/40/40.jpg" alt="Avatar">
            </div>
            <div class="user-info">
                <span class="user-username" id="userUsername" onclick="window.location.href='profile.html'" style="cursor: pointer;">Utilisateur</span>
                <span class="user-role" id="userRole">Membre</span>
            </div>
            <!-- Bouton notification intÃ©grÃ© au profil -->
            <button class="notification-btn" id="notificationBtn" onclick="toggleNotifications()" style="position: relative; top: 0; right: 0; margin-left: 10px;">
                <span class="bell-icon"></span>
                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </button>
        </div>
        
        <!-- #SECTION AUTHENTIFICATION# -->
        <div class="auth-buttons" id="authButtons">
            <button class="btn" onclick="openModal('loginModal')">Se Connecter</button>
            <button class="btn" onclick="openModal('registerModal')">CrÃ©er un Compte</button>
        </div>
    </header>

    <!-- Critical functions - MUST load BEFORE any onclick handlers -->
    <script>
        console.log('ðŸš€ Loading critical functions...');
        
        // Modal functions - DEFINED BEFORE HTML
        function openModal(modalId) {
            console.log('Opening modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                console.log('âœ… Modal opened successfully');
            } else {
                console.error('âŒ Modal not found:', modalId);
            }
        }

        function closeModal(modalId) {
            console.log('Closing modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                console.log('âœ… Modal closed successfully');
            } else {
                console.error('âŒ Modal not found:', modalId);
            }
        }

        // Other critical functions
        function openCategory(categoryName) {
            console.log('Opening category:', categoryName);
            window.location.href = `category-posts.html?category=${categoryName}`;
        }

        function openThread(threadId) {
            console.log('Opening thread:', threadId);
            window.location.href = `post-detail.html?id=${threadId}`;
        }

        function viewProfile(username) {
            console.log('Viewing profile:', username);
            window.location.href = `public-profile.html?user=${username}`;
        }

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            const currentDisplay = panel.style.display;
            panel.style.display = currentDisplay === 'block' ? 'none' : 'block';
        }

        function clearNotifications() {
            console.log('Clearing notifications...');
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '<div class="notification-empty">Aucune notification</div>';
            
            const badge = document.getElementById('notificationBadge');
            badge.style.display = 'none';
            badge.textContent = '0';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        console.log('âœ… All critical functions loaded successfully');
    </script>

    <!-- #SECTION NOTIFICATIONS# -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3 class="notification-title">Notifications</h3>
            <button class="clear-notifications" onclick="clearNotifications()">Effacer</button>
        </div>
        <div id="notificationsList">
            <div class="notification-empty">
                Aucune notification
            </div>
        </div>
    </div>

    <!-- #SECTION CONTENU PRINCIPAL# -->
    <main>
        <!-- #SECTION HERO AMÃ‰LIORÃ‰# -->
        <section class="hero-section-enhanced">
            <div class="hero-background">
                <div class="hero-particles"></div>
                <div class="hero-grid"></div>
            </div>
            
            <div class="hero-content">
                <div class="hero-text">
                    <h2 class="hero-title">
                        <span class="hero-title-main">Bienvenue sur</span>
                        <span class="hero-title-brand">Doomsday Forums</span>
                        <span class="hero-title-sub">La communautÃ© cybersÃ©curitÃ©</span>
                    </h2>
                    <p class="hero-subtitle">
                        Explorez, apprenez et maÃ®trisez l'art de la cybersÃ©curitÃ© 
                        <span class="hero-highlight">avec des experts passionnÃ©s</span>
                    </p>
                    
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-number" data-target="1234">0</div>
                            <div class="stat-label">Membres</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" data-target="5678">0</div>
                            <div class="stat-label">Messages</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" data-target="890">0</div>
                            <div class="stat-label">Sujets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" data-target="45">0</div>
                            <div class="stat-label">En ligne</div>
                        </div>
                    </div>
                    
                    <div class="hero-actions">
                        <button class="btn-hero-primary" onclick="scrollToSection('forums')">
                            <span>ðŸš€ Explorer les Forums</span>
                            <div class="btn-glow"></div>
                        </button>
                        <button class="btn-hero-secondary" onclick="openModal('registerModal')">
                            <span>ðŸ” Rejoindre la CommunautÃ©</span>
                            <div class="btn-glow"></div>
                        </button>
                    </div>
                </div>
                
                <div class="hero-visual">
                    <div class="hero-shield">
                        <div class="shield-ring"></div>
                        <div class="shield-core">ðŸ›¡ï¸</div>
                        <div class="shield-particles"></div>
                    </div>
                </div>
            </div>
            
            <div class="hero-scroll-indicator">
                <div class="scroll-arrow"></div>
                <span>Scrollez pour explorer</span>
            </div>
        </section>

        <!-- #SECTION FORUMS - CATÃ‰GORIES PRINCIPALES# -->
        <section class="discussion-section">
            <h3 class="section-title">â—­ Sections de CybersÃ©curitÃ©</h3>
            <div class="categories-grid">
                <div class="category-card" onclick="openCategory('general')">
                    <div class="category-icon">â—ˆ</div>
                    <div class="category-title">GÃ©nÃ©ral</div>
                    <div class="category-description">Discussions gÃ©nÃ©rales sur la cybersÃ©curitÃ©</div>
                    <div class="category-stats">
                        <span>156 sujets</span>
                        <span>1.2k messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('database')">
                    <div class="category-icon">â—‰</div>
                    <div class="category-title">Database</div>
                    <div class="category-description">SÃ©curitÃ© des bases de donnÃ©es et injections SQL</div>
                    <div class="category-stats">
                        <span>89 sujets</span>
                        <span>756 messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('tools')">
                    <div class="category-icon">âš™</div>
                    <div class="category-title">Tools</div>
                    <div class="category-description">Outils de pentest et d'analyse de sÃ©curitÃ©</div>
                    <div class="category-stats">
                        <span>124 sujets</span>
                        <span>943 messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('network')">
                    <div class="category-icon">â—­</div>
                    <div class="category-title">Network</div>
                    <div class="category-description">SÃ©curitÃ© rÃ©seau et protocoles</div>
                    <div class="category-stats">
                        <span>67 sujets</span>
                        <span>512 messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('web')">
                    <div class="category-icon">â—ˆ</div>
                    <div class="category-title">Web Security</div>
                    <div class="category-description">VulnÃ©rabilitÃ©s web et sÃ©curisation applicative</div>
                    <div class="category-stats">
                        <span>203 sujets</span>
                        <span>1.8k messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('malware')">
                    <div class="category-icon">â—‰</div>
                    <div class="category-title">Malware</div>
                    <div class="category-description">Analyse de malwares et reverse engineering</div>
                    <div class="category-stats">
                        <span>45 sujets</span>
                        <span>234 messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('cryptography')">
                    <div class="category-icon">âš™</div>
                    <div class="category-title">Cryptography</div>
                    <div class="category-description">Chiffrement, cryptanalyse et protocoles</div>
                    <div class="category-stats">
                        <span>78 sujets</span>
                        <span>445 messages</span>
                    </div>
                </div>
                
                <div class="category-card" onclick="openCategory('forensics')">
                    <div class="category-icon">â—­</div>
                    <div class="category-title">Forensics</div>
                    <div class="category-description">Analyse forensique et investigation numÃ©rique</div>
                    <div class="category-stats">
                        <span>92 sujets</span>
                        <span>678 messages</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- #SECTION CRÃ‰ATION DE SUJET# -->
        <section class="discussion-section">
            <h3 class="section-title">â—­ CrÃ©er un nouveau sujet</h3>
            <div class="create-thread-container">
                <div class="form-group">
                    <label for="threadTitle">Titre du sujet</label>
                    <input type="text" id="threadTitle" placeholder="Entrez un titre clair et descriptif..." maxlength="100">
                </div>
                <div class="form-group">
                    <label for="threadCategory">CatÃ©gorie</label>
                    <select id="threadCategory">
                        <option value="">Choisissez une catÃ©gorie...</option>
                        <option value="general">GÃ©nÃ©ral</option>
                        <option value="database">Database</option>
                        <option value="tools">Tools</option>
                        <option value="network">Network</option>
                        <option value="web">Web Security</option>
                        <option value="malware">Malware</option>
                        <option value="cryptography">Cryptography</option>
                        <option value="forensics">Forensics</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="threadContent">Contenu</label>
                    <textarea id="threadContent" placeholder="DÃ©crivez votre sujet en dÃ©tail..." rows="6"></textarea>
                </div>
                <div class="form-group">
                    <label for="threadTags">Tags (sÃ©parÃ©s par des virgules)</label>
                    <input type="text" id="threadTags" placeholder="ex: sÃ©curitÃ©, tutorial, question">
                </div>
                <button class="btn-primary" onclick="createThread()">CrÃ©er le sujet</button>
            </div>
        </section>

        <!-- #SECTION DERNIÃˆRES DISCUSSIONS# -->
        <section class="discussion-section">
            <h3 class="section-title">â—­ DerniÃ¨res Discussions</h3>
            <ul class="thread-list" id="threadList">
                <li class="thread-item" onclick="openThread(1)">
                    <div class="thread-title">Bienvenue sur Doomsday Forums</div>
                    <div class="thread-meta">
                        <span class="thread-author" onclick="viewProfile('Admin'); event.stopPropagation();">Par Admin</span>
                        <div class="thread-stats">
                            <span>15 rÃ©ponses</span>
                            <span>il y a 2 heures</span>
                        </div>
                    </div>
                </li>
                <li class="thread-item" onclick="openThread(2)">
                    <div class="thread-title">RÃ¨gles du forum</div>
                    <div class="thread-meta">
                        <span class="thread-author" onclick="viewProfile('Moderateur'); event.stopPropagation();">Par Moderateur</span>
                        <div class="thread-stats">
                            <span>8 rÃ©ponses</span>
                            <span>il y a 5 heures</span>
                        </div>
                    </div>
                </li>
                <li class="thread-item" onclick="openThread(3)">
                    <div class="thread-title">PrÃ©sentation des membres</div>
                    <div class="thread-meta">
                        <span class="thread-author" onclick="viewProfile('Community'); event.stopPropagation();">Par Community</span>
                        <div class="thread-stats">
                            <span>42 rÃ©ponses</span>
                            <span>il y a 1 jour</span>
                        </div>
                    </div>
                </li>
                <li class="thread-item" onclick="openThread(4)">
                    <div class="thread-title">Suggestions pour le forum</div>
                    <div class="thread-meta">
                        <span class="thread-author" onclick="viewProfile('User123'); event.stopPropagation();">Par User123</span>
                        <div class="thread-stats">
                            <span>23 rÃ©ponses</span>
                            <span>il y a 2 jours</span>
                        </div>
                    </div>
                </li>
            </ul>
        </section>
    </main>

    <!-- Chat Section -->
    <button class="chat-toggle" id="chatToggle" onclick="toggleChat()">ðŸ’¬</button>
    
    

    <!-- Avatar Modal -->
    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Choisir votre avatar</h3>
                <button class="close-btn" onclick="closeModal('avatarModal')">&times;</button>
            </div>
            <div class="avatar-grid">
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar1/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar1/100/100.jpg" alt="Avatar 1">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar2/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar2/100/100.jpg" alt="Avatar 2">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar3/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar3/100/100.jpg" alt="Avatar 3">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar4/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar4/100/100.jpg" alt="Avatar 4">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar5/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar5/100/100.jpg" alt="Avatar 5">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar6/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar6/100/100.jpg" alt="Avatar 6">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar7/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar7/100/100.jpg" alt="Avatar 7">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar8/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar8/100/100.jpg" alt="Avatar 8">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar9/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar9/100/100.jpg" alt="Avatar 9">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar10/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar10/100/100.jpg" alt="Avatar 10">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar11/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar11/100/100.jpg" alt="Avatar 11">
                </div>
                <div class="avatar-option" onclick="selectAvatar('https://picsum.photos/seed/avatar12/100/100.jpg')">
                    <img src="https://picsum.photos/seed/avatar12/100/100.jpg" alt="Avatar 12">
                </div>
            </div>
            <div class="form-group" style="margin-top: 20px;">
                <label>URL personnalisÃ©e (optionnel)</label>
                <input type="url" id="customAvatarUrl" placeholder="https://example.com/avatar.jpg">
            </div>
            <button class="btn-primary" onclick="saveAvatar()">Sauvegarder</button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('loginModal')">&times;</button>
            <h2 class="modal-title">Connexion</h2>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" autocomplete="current-password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Se Connecter</button>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('registerModal')">&times;</button>
            <h2 class="modal-title">CrÃ©er un Compte</h2>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="registerUsername">Nom d'utilisateur</label>
                    <input type="text" id="registerUsername" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" autocomplete="new-password" required>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirmer le mot de passe</label>
                    <input type="password" id="registerConfirmPassword" autocomplete="new-password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">CrÃ©er un Compte</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
    
    <!-- Firebase initialization - MUST be available immediately -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB03b3P5Ec33HWCJVS7y6t6x7H-Nx6YsTc",
            authDomain: "doomsday-forums.firebaseapp.com",
            databaseURL: "https://doomsday-forums-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "doomsday-forums",
            storageBucket: "doomsday-forums.firebasestorage.app",
            messagingSenderId: "345452079794",
            appId: "1:345452079794:web:14b4978afb203a9d84b7ab",
            measurementId: "G-W1YDYYQKRR"
        };

        // Initialize Firebase immediately
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        
        // Global variables
        let currentUser = null;
        let currentUserRole = 'member';
        let currentUserUsernameColor = '#ffffff';
        let replyingTo = null;
        let notifications = [];
        let notificationCount = 0;
        let notificationsListener = null;
        let chatMessages = [];
        let connectedUsers = [];
        
        console.log('âœ… Firebase initialized successfully');
    </script>
    
    <script src="security.js" onerror="console.warn('Security module not loaded, continuing without security features');"></script>
    <script>
        // Real-time Firebase functions
        function sendMessageToFirebase(message) {
            console.log('sendMessageToFirebase appelÃ© avec:', message);
            
            if (!currentUser || !auth.currentUser) {
                console.error('Utilisateur non connectÃ©, impossible d\'envoyer le message');
                throw new Error('Vous devez Ãªtre connectÃ© pour envoyer des messages');
            }
            
            const messageData = {
                user: currentUser,
                text: message,
                timestamp: Date.now()
            };
            
            console.log('DonnÃ©es du message:', messageData);
            
            if (!database) {
                console.error('Database Firebase non initialisÃ©e');
                throw new Error('Database Firebase non initialisÃ©e');
            }
            
            database.ref('messages').push(messageData)
                .then(() => {
                    console.log('Message envoyÃ© avec succÃ¨s Ã  Firebase');
                })
                .catch((error) => {
                    console.error('Erreur Firebase:', error);
                    throw error;
                });
        }

        function listenToMessages() {
            console.log('DÃ©marrage Ã©coute des messages Firebase');
            
            // Check if database is available
            if (!database) {
                console.warn('âš ï¸ Base de donnÃ©es non disponible, Ã©coute des messages dÃ©sactivÃ©e');
                return;
            }
            
            // Clear existing messages first
            const messagesContainer = document.getElementById('chatMessages');
            if (messagesContainer) {
                messagesContainer.innerHTML = '';
            }
            
            try {
                database.ref('messages').orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                    console.log('Messages reÃ§us de Firebase:', snapshot.val());
                    const messages = snapshot.val();
                    
                    if (!messagesContainer) {
                        console.error('Container des messages non trouvÃ©');
                        return;
                    }
                    
                    // Clear and rebuild all messages to avoid duplicates
                    messagesContainer.innerHTML = '';
                    
                    // Add all Firebase messages with avatars
                    if (messages) {
                        Object.values(messages).forEach(async msg => {
                            const time = new Date(msg.timestamp).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                            console.log('Ajout du message:', msg);
                            
                            // Get user avatar
                            let avatarUrl = null;
                            if (msg.user && database) {
                                try {
                                    const snapshot = await database.ref('users').orderByChild('username').equalTo(msg.user).once('value');
                                    const users = snapshot.val();
                                    if (users) {
                                        const userId = Object.keys(users)[0];
                                        const userData = users[userId];
                                        avatarUrl = userData.avatar || null;
                                    }
                                } catch (error) {
                                    console.warn('âš ï¸ Erreur lors de la rÃ©cupÃ©ration de l\'avatar:', error.message);
                                }
                            }
                            
                            addMessageFromFirebase(msg.user, msg.text, time, avatarUrl);
                        });
                    }
                    
                    // Scroll to bottom
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    console.log('Messages affichÃ©s, total:', Object.keys(messages || {}).length);
                }, (error) => {
                    console.error('âŒ Erreur d\'Ã©coute des messages Firebase:', error.message);
                });
            } catch (error) {
                console.error('âŒ Erreur lors de la configuration de l\'Ã©coute des messages:', error.message);
            }
        }

        function addMessageFromFirebase(author, text, time, avatarUrl = null) {
            console.log('addMessageFromFirebase appelÃ© avec:', {author, text, time, avatarUrl});
            
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) {
                console.log('â„¹ï¸ Chat non disponible - message ignorÃ©:', {author, text});
                return; // Ne pas afficher d'erreur, juste ignorer
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            // Create avatar HTML
            let avatarHTML = '';
            if (avatarUrl) {
                avatarHTML = `
                    <div class="message-avatar">
                        <img src="${avatarUrl}" alt="${sanitizeInput(author)}" onerror="this.parentElement.innerHTML='${author.substring(0, 2).toUpperCase()}';">
                    </div>
                `;
            } else {
                const initials = author ? author.substring(0, 2).toUpperCase() : '??';
                avatarHTML = `
                    <div class="message-avatar">
                        ${initials}
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-author">
                    ${avatarHTML}
                    ${sanitizeInput(author)}
                </div>
                <div class="message-text">${sanitizeInput(text)}</div>
                <div class="message-time">${time}</div>
            `;
            
            console.log('Message HTML crÃ©Ã©:', messageDiv.innerHTML);
            messagesContainer.appendChild(messageDiv);
            console.log('Message ajoutÃ© au DOM');
        }

        function updateOnlineUsersInFirebase() {
            if (!auth.currentUser) return;
            
            const userData = {
                name: currentUser || 'Utilisateur',
                role: 'admin', // FORCE ADMIN ROLE IN DATABASE TOO
                status: 'online',
                lastSeen: Date.now()
            };
            
            console.log('ðŸ”¥ Updating Firebase with ADMIN role:', userData);
            
            database.ref('onlineUsers/' + auth.currentUser.uid).set(userData).then(() => {
                console.log('âœ… Firebase updated with admin role');
            }).catch((error) => {
                console.log('âŒ Firebase update failed:', error);
            });
        }

        function listenToOnlineUsers() {
            console.log('DÃ©marrage Ã©coute des utilisateurs en ligne');
            
            // Check if database is available
            if (!database) {
                console.warn('âš ï¸ Base de donnÃ©es non disponible, Ã©coute des utilisateurs en ligne dÃ©sactivÃ©e');
                return;
            }
            
            try {
                database.ref('users').on('value', (snapshot) => {
                    const users = snapshot.val();
                    let onlineCount = 0;
                    if (users) {
                        Object.values(users).forEach(user => {
                            if (user.status === 'online') {
                                onlineCount++;
                            }
                        });
                    }
                    
                    const onlineCountElement = document.getElementById('onlineUsersCount');
                    if (onlineCountElement) {
                        onlineCountElement.textContent = onlineCount;
                    } else {
                        console.warn('âš ï¸ Ã‰lÃ©ment onlineUsersCount non trouvÃ©');
                    }
                }, (error) => {
                    console.error('âŒ Erreur d\'Ã©coute des utilisateurs en ligne:', error.message);
                });
            } catch (error) {
                console.error('âŒ Erreur lors de la configuration de l\'Ã©coute des utilisateurs en ligne:', error.message);
            }
        }

        // #FONCTIONNALITÃ‰S AMÃ‰LIORÃ‰ES - ANIMATIONS ET INTERACTIONS#
        
        // Toggle Mobile Menu
        function toggleMobileMenu() {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('mobile-open');
        }
        
        // Smooth Scroll to Section
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // Animated Counter for Stats
        function animateCounter(element, target, duration = 2000) {
            const start = 0;
            const increment = target / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current).toLocaleString();
            }, 16);
        }
        
        // Initialize Hero Animations
        function initializeHeroAnimations() {
            // Animate stats counters
            const statNumbers = document.querySelectorAll('.stat-number');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const target = parseInt(entry.target.dataset.target);
                        animateCounter(entry.target, target);
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            statNumbers.forEach(stat => observer.observe(stat));
            
            // Add parallax effect to hero background
            window.addEventListener('scroll', () => {
                const scrolled = window.pageYOffset;
                const heroBackground = document.querySelector('.hero-background');
                if (heroBackground) {
                    heroBackground.style.transform = `translateY(${scrolled * 0.5}px)`;
                }
            });
        }
        
        // Enhanced Loading Screen Management
        function initializeLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            
            // Hide loading screen after everything is loaded
            window.addEventListener('load', () => {
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }, 1000);
            });
            
            // Fallback: hide after 5 seconds max
            setTimeout(() => {
                if (!loadingScreen.classList.contains('hidden')) {
                    loadingScreen.classList.add('hidden');
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }
            }, 5000);
        }
        
        // Enhanced User Interface Updates
        function updateUserInterfaceEnhanced() {
            const userInfo = document.getElementById('userInfo');
            const authButtons = document.getElementById('authButtons');
            const usernameDisplay = document.getElementById('usernameDisplay');
            const userAvatarSmall = document.getElementById('userAvatarSmall');
            const userRoleBadge = document.getElementById('userRoleBadge');
            const adminLinks = document.querySelectorAll('.admin-only');
            
            if (auth.currentUser) {
                // User is logged in
                if (userInfo) userInfo.style.display = 'flex';
                if (authButtons) authButtons.style.display = 'none';
                
                // Update user info
                if (usernameDisplay) usernameDisplay.textContent = currentUser || 'Utilisateur';
                if (userAvatarSmall) {
                    userAvatarSmall.textContent = (currentUser || 'U').substring(0, 2).toUpperCase();
                }
                
                // Update role badge
                if (userRoleBadge) {
                    const role = currentUserRole || 'member';
                    userRoleBadge.textContent = role.charAt(0).toUpperCase() + role.slice(1);
                    userRoleBadge.style.background = getRoleGradient(role);
                }
                
                // Show admin links if admin
                if (currentUserRole === 'admin') {
                    adminLinks.forEach(link => link.style.display = 'inline-block');
                }
            } else {
                // User is not logged in
                if (userInfo) userInfo.style.display = 'none';
                if (authButtons) authButtons.style.display = 'flex';
                adminLinks.forEach(link => link.style.display = 'none');
            }
        }
        
        // Get Role Gradient Color
        function getRoleGradient(role) {
            const gradients = {
                admin: 'linear-gradient(135deg, #ff0000, #cc0000)',
                moderator: 'linear-gradient(135deg, #ff6600, #cc5200)',
                vip: 'linear-gradient(135deg, #ffd700, #ccaa00)',
                member: 'linear-gradient(135deg, #dc143c, #8b0000)'
            };
            return gradients[role] || gradients.member;
        }
        
        // Enhanced Toast Notifications
        function showEnhancedToast(message, type = 'info', duration = 3000) {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">${message}</div>
                <div class="toast-time">${new Date().toLocaleTimeString('fr-FR')}</div>
                <div class="toast-progress"></div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove with animation
            setTimeout(() => {
                toast.classList.add('toast-removing');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, duration);
        }
        
        // Initialize Enhanced Features
        function initializeEnhancedFeatures() {
            initializeLoadingScreen();
            initializeHeroAnimations();
            updateUserInterfaceEnhanced();
            
            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K for quick search (future feature)
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    // Future: open search modal
                    showEnhancedToast('Recherche bientÃ´t disponible!', 'info');
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    const modals = document.querySelectorAll('.modal[style*="block"]');
                    modals.forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });
            
            // Add page visibility detection
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    console.log('ðŸ‘ï¸ Page is visible - refreshing data...');
                    // Future: refresh real-time data
                }
            });
            
            console.log('âœ… Enhanced features initialized successfully');
        }
        
        // Enhanced Error Handling
        function handleEnhancedError(error, context = 'Unknown') {
            console.error(`âŒ Enhanced Error [${context}]:`, error);
            
            // Show user-friendly error message
            const errorMessage = error.message || 'Une erreur est survenue';
            showEnhancedToast(`Erreur: ${errorMessage}`, 'error');
            
            // Log error for debugging (in production, send to analytics)
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: errorMessage,
                    fatal: false,
                    custom_map: { context }
                });
            }
        }
        
        // Performance Monitoring
        function initializePerformanceMonitoring() {
            // Monitor page load time
            window.addEventListener('load', () => {
                const loadTime = performance.now();
                console.log(`ðŸ“Š Page loaded in ${loadTime.toFixed(2)}ms`);
                
                // Show performance notification if slow
                if (loadTime > 3000) {
                    showEnhancedToast('Chargement plus lent que la normale', 'warning');
                }
            });
            
            // Monitor memory usage (if available)
            if (performance.memory) {
                setInterval(() => {
                    const memory = performance.memory;
                    const used = (memory.usedJSHeapSize / 1048576).toFixed(2);
                    const total = (memory.totalJSHeapSize / 1048576).toFixed(2);
                    
                    if (used > total * 0.9) {
                        console.warn('âš ï¸ High memory usage detected');
                        showEnhancedToast('Utilisation mÃ©moire Ã©levÃ©e', 'warning');
                    }
                }, 30000); // Check every 30 seconds
            }
        }

        // Initialize Firebase listeners with retry mechanism
        let firebaseInitAttempts = 0;
        const maxFirebaseInitAttempts = 5;
        let forceUpdateInterval;
        
        function initializeFirebaseWithRetry() {
            firebaseInitAttempts++;
            console.log(`ðŸ”„ Tentative d'initialisation Firebase ${firebaseInitAttempts}/${maxFirebaseInitAttempts}`);
            
            if (!auth.currentUser) {
                console.log('âŒ Utilisateur non connectÃ©, tentative suivante...');
                if (firebaseInitAttempts < maxFirebaseInitAttempts) {
                    setTimeout(initializeFirebaseWithRetry, 2000);
                } else {
                    console.log('âŒ Ã‰chec de l\'initialisation aprÃ¨s plusieurs tentatives - ArrÃªt des tentatives');
                }
                return;
            }
            
            try {
                console.log('âœ… Utilisateur connectÃ©, initialisation des listeners...');
                
                // VALIDATION AUTOMATIQUE DU CODE AVANT TOUT
                if (!validateCodeBeforeExecution()) {
                    console.error('âŒ Validation du code Ã©chouÃ©e - ArrÃªt de l\'initialisation');
                    return;
                }
                
                // Reset attempts on successful connection
                firebaseInitAttempts = 0;
                
                // Force immediate update first
                forceImmediateUpdate();
                
                // Start listeners (even if slow, we have forced updates)
                listenToMessages();
                listenToOnlineUsers();
                updateOnlineUsersInFirebase();
                addSystemMessage('ConnectÃ© Ã  Firebase - Synchronisation active !');
                
                // Force role update every 3 seconds (more frequent)
                if (forceUpdateInterval) clearInterval(forceUpdateInterval);
                forceUpdateInterval = setInterval(() => {
                    if (auth.currentUser && currentUser) {
                        console.log('ðŸ”„ Mise Ã  jour forcÃ©e du rÃ´le...');
                        forceImmediateUpdate();
                    }
                }, 3000);
                
                // Also force every 10 seconds
                setInterval(() => {
                    if (auth.currentUser && currentUser) {
                        console.log('ðŸ”„ Mise Ã  jour forcÃ©e (10s)...');
                        forceImmediateUpdate();
                    }
                }, 10000);
                
                console.log('âœ… Initialisation Firebase terminÃ©e avec succÃ¨s');
                
            } catch (error) {
                console.error('âŒ Erreur lors de l\'initialisation:', error);
                if (firebaseInitAttempts < maxFirebaseInitAttempts) {
                    setTimeout(initializeFirebaseWithRetry, 2000);
                } else {
                    console.error('âŒ Erreur critique lors de l\'initialisation - ArrÃªt des tentatives');
                    // Continuer sans Firebase pour Ã©viter de bloquer l'interface
                    addSystemMessage('Mode dÃ©gradÃ© - Certaines fonctionnalitÃ©s peuvent Ãªtre limitÃ©es');
                }
            }
        }
        
        // Start initialization after 1 second (faster)
        setTimeout(initializeFirebaseWithRetry, 1000);
        
        // Enhanced security functions
        function sanitizeInput(input) {
            if (typeof input !== 'string') return '';
            
            return input
                // Remove script tags and content
                .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                // Remove JavaScript: protocol
                .replace(/javascript:/gi, '')
                // Remove on* event handlers
                .replace(/on\w+\s*=/gi, '')
                // Remove HTML tags
                .replace(/<[^>]*>/g, '')
                // Remove dangerous characters
                .replace(/[<>"'&]/g, '')
                // Remove SQL injection patterns
                .replace(/(union|select|insert|update|delete|drop|create|alter|exec|script)/gi, '')
                // Remove XSS patterns
                .replace(/(document|window|alert|prompt|confirm|eval|setTimeout|setInterval)/gi, '')
                // Trim whitespace
                .trim();
        }

        function validateEmail(email) {
            if (!email || typeof email !== 'string') return false;
            
            // Enhanced email validation
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(email)) return false;
            
            // Additional security checks
            if (email.includes('..')) return false;
            if (email.startsWith('.') || email.endsWith('.')) return false;
            if (email.length > 254) return false;
            
            return true;
        }

        function validatePassword(password) {
            if (!password || typeof password !== 'string') return false;
            
            // Enhanced password validation
            if (password.length < 8) return false;
            if (password.length > 128) return false;
            
            // Check for common patterns
            const commonPatterns = [
                /^(.)\1+$/, // All same characters
                /^(123|abc|password|qwerty)/i, // Common passwords
                /^(.){1,2}\1{1,2}$/, // Repeated patterns like "aa", "bb"
            ];
            
            for (const pattern of commonPatterns) {
                if (pattern.test(password)) return false;
            }
            
            return true;
        }

        function validateUsername(username) {
            if (!username || typeof username !== 'string') return false;
            
            // Username validation
            if (username.length < 3 || username.length > 30) return false;
            
            // Only allow alphanumeric, underscores, and hyphens
            const usernameRegex = /^[a-zA-Z0-9_-]+$/;
            if (!usernameRegex.test(username)) return false;
            
            // Prevent reserved names
            const reservedNames = ['admin', 'administrator', 'root', 'system', 'moderator', 'null', 'undefined'];
            if (reservedNames.includes(username.toLowerCase())) return false;
            
            return true;
        }

        function rateLimitCheck(action) {
            const now = Date.now();
            const limits = {
                'login': { attempts: 5, window: 900000 }, // 15 minutes
                'register': { attempts: 3, window: 3600000 }, // 1 hour
                'message': { attempts: 5, window: 1000 } // 5 messages par seconde
            };
            
            const limit = limits[action];
            if (!limit) return true;
            
            const key = `rate_limit_${action}`;
            const attempts = JSON.parse(localStorage.getItem(key) || '[]');
            
            // Clean old attempts
            const validAttempts = attempts.filter(time => now - time < limit.window);
            
            if (validAttempts.length >= limit.attempts) {
                const oldestAttempt = Math.min(...validAttempts);
                const waitTime = Math.ceil((limit.window - (now - oldestAttempt)) / 1000);
                throw new Error(`Trop de tentatives. Attendez ${waitTime} secondes.`);
            }
            
            // Add current attempt
            validAttempts.push(now);
            localStorage.setItem(key, JSON.stringify(validAttempts));
            
            return true;
        }

        function handleLogin(event) {
            event.preventDefault();
            
            try {
                rateLimitCheck('login');
            } catch (error) {
                alert(error.message);
                return;
            }
            
            const email = sanitizeInput(document.getElementById('loginEmail').value);
            const password = sanitizeInput(document.getElementById('loginPassword').value);
            
            if (!validateEmail(email)) {
                alert('Email invalide!');
                return;
            }
            
            if (!validatePassword(password)) {
                alert('Mot de passe trop court (minimum 8 caractÃ¨res)!');
                return;
            }
            
            // Firebase authentication
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    console.log('Connexion rÃ©ussie:', userCredential.user);
                    closeModal('loginModal');
                    event.target.reset();
                })
                .catch((error) => {
                    console.error('Erreur de connexion:', error);
                    const errorMessage = getFirebaseErrorMessage(error.code);
                    alert('Erreur de connexion: ' + errorMessage);
                });
        }

        function handleRegister(event) {
            event.preventDefault();
            
            try {
                rateLimitCheck('register');
            } catch (error) {
                alert(error.message);
                return;
            }
            
            const username = sanitizeInput(document.getElementById('registerUsername').value);
            const email = sanitizeInput(document.getElementById('registerEmail').value);
            const password = sanitizeInput(document.getElementById('registerPassword').value);
            const confirmPassword = sanitizeInput(document.getElementById('registerConfirmPassword').value);
            
            if (!validateUsername(username)) {
                alert('Nom d\'utilisateur invalide! (3-30 caractÃ¨res, lettres, chiffres, _ et - seulement)');
                return;
            }
            
            if (!validateEmail(email)) {
                alert('Email invalide!');
                return;
            }
            
            if (!validatePassword(password)) {
                alert('Mot de passe trop faible! (minimum 8 caractÃ¨res, pas de motifs communs)');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Les mots de passe ne correspondent pas!');
                return;
            }
            
            // Check if username already exists
            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        alert('Ce nom d\'utilisateur est dÃ©jÃ  pris! Choisissez un autre.');
                        return;
                    }
                    
                    // Username is available, create account
                    return auth.createUserWithEmailAndPassword(email, password);
                })
                .then((userCredential) => {
                    if (!userCredential) return; // Username was taken
                    
                    const user = userCredential.user;
                    
                    // Update profile with username (this sets displayName)
                    return user.updateProfile({
                        displayName: username
                    }).then(() => {
                        console.log('Profile mis Ã  jour avec username:', username);
                        
                        // Give admin role to Neyzoxx, otherwise member
                        const userRole = 'admin';
                        
                        // Save user data in database with role
                        return database.ref('users/' + user.uid).set({
                            username: username,
                            email: email,
                            role: userRole,
                            createdAt: Date.now(),
                            lastSeen: Date.now(),
                            ipAddress: getClientIP()
                        });
                    });
                })
                .then(() => {
                    console.log('Compte crÃ©Ã© avec succÃ¨s');
                    closeModal('registerModal');
                    event.target.reset();
                    
                    // Show special message for Neyzoxx
                    if (username === 'Neyzoxx') {
                        alert('ðŸŽ‰ Bienvenue administrateur Neyzoxx! Vous avez maintenant accÃ¨s au panneau d\'administration.');
                    }
                })
                .catch((error) => {
                    console.error('Erreur d\'inscription:', error);
                    const errorMessage = getFirebaseErrorMessage(error.code);
                    alert('Erreur d\'inscription: ' + errorMessage);
                });
        }

        function getFirebaseErrorMessage(errorCode) {
            const errorMessages = {
                'auth/email-already-in-use': 'Cet email est dÃ©jÃ  utilisÃ©!',
                'auth/invalid-email': 'Email invalide!',
                'auth/operation-not-allowed': 'OpÃ©ration non autorisÃ©e!',
                'auth/weak-password': 'Mot de passe trop faible!',
                'auth/user-not-found': 'Utilisateur non trouvÃ©!',
                'auth/wrong-password': 'Mot de passe incorrect!',
                'auth/too-many-requests': 'Trop de tentatives! RÃ©essayez plus tard.',
                'auth/network-request-failed': 'Erreur rÃ©seau! VÃ©rifiez votre connexion.',
                'auth/configuration-not-found': 'Configuration Firebase non trouvÃ©e. Activez l\'authentification dans la console Firebase.'
            };
            
            return errorMessages[errorCode] || 'Erreur inconnue: ' + errorCode;
        }

        function getClientIP() {
            // In a real implementation, you'd get this from a server
            // For now, return a placeholder
            return 'client_ip_placeholder';
        }

        function handleLogout() {
            auth.signOut().then(() => {
                console.log('DÃ©connexion rÃ©ussie');
            }).catch((error) => {
                console.error('Erreur de dÃ©connexion:', error);
            });
        }

        // Listen for auth state changes
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Use displayName (username) from profile, fallback to email prefix
                currentUser = user.displayName || user.email.split('@')[0];
                
                // FORCE ADMIN ROLE IMMEDIATELY - don't wait for database
                currentUserRole = 'admin';
                console.log('ðŸ”¥ FORCED ADMIN ROLE - User:', currentUser);
                
                console.log('Utilisateur connectÃ©:', currentUser);
                
                // Show user profile, hide auth buttons
                document.getElementById('userProfile').style.display = 'flex';
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('accountButtons').style.display = 'flex';
                
                // Update user info in profile IMMEDIATELY
                updateUserProfile();
                loadUserAvatar();
                
                // Show admin link if user is admin or moderator
                checkAndShowAdminLink();
                // checkAndShowCustomizationLink(); // DÃ©sactivÃ© - bouton dÃ©placÃ© dans le profil
                
                // Initialize Firebase with retry mechanism
                initializeFirebaseWithRetry();
                
                // Force immediate UI update after 500ms
                setTimeout(() => {
                    forceImmediateUpdate();
                }, 500);
                
            } else {
                currentUser = null;
                currentUserRole = 'member';
                console.log('Utilisateur dÃ©connectÃ©');
                
                // Hide user profile, show auth buttons
                document.getElementById('userProfile').style.display = 'none';
                document.getElementById('authButtons').style.display = 'flex';
                document.getElementById('accountButtons').style.display = 'none';
                
                hideAdminLink();
                hideCustomizationLink();
            }
        });

        // Update user profile display
        function updateUserProfile() {
            console.log('ðŸ”„ updateUserProfile appelÃ© - currentUser:', currentUser, 'role:', currentUserRole);
            
            // ALWAYS FORCE ADMIN ROLE
            currentUserRole = 'admin';
            
            if (currentUser) {
                document.getElementById('userUsername').textContent = currentUser;
                document.getElementById('userProfile').style.display = 'flex';
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('accountButtons').style.display = 'flex';
                
                // FORCE ADMIN DISPLAY - NO EXCEPTIONS
                const roleElement = document.getElementById('userRole');
                if (roleElement) {
                    roleElement.textContent = 'ADMIN';
                    roleElement.style.color = '#ff0000';
                    roleElement.style.fontWeight = 'bold';
                    roleElement.style.textTransform = 'uppercase';
                    roleElement.style.fontSize = '0.9rem';
                    console.log('âœ… RÃ´le ADMIN forcÃ© dans l\'affichage');
                } else {
                    console.error('âŒ Ã‰lÃ©ment userRole non trouvÃ© dans updateUserProfile!');
                }
            }
            
            // Update role selector and lock it
            const roleSelect = document.getElementById('roleSelect');
            if (roleSelect) {
                roleSelect.value = 'admin';
                roleSelect.disabled = true; // LOCK SELECTOR
                console.log('âœ… SÃ©lecteur de rÃ´le bloquÃ© sur Admin dans updateUserProfile');
            }
        }

        // Load user avatar
        function loadUserAvatar() {
            if (auth.currentUser) {
                database.ref('avatars/' + auth.currentUser.uid).once('value').then((snapshot) => {
                    const avatarUrl = snapshot.val();
                    if (avatarUrl) {
                        document.getElementById('userAvatar').src = avatarUrl;
                    }
                }).catch((error) => {
                    console.log('Mode test : avatar par dÃ©faut');
                });
            }
        }

        // Avatar functions
        let selectedAvatar = null;

        function openAvatarModal() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ© pour changer votre avatar!');
                return;
            }
            
            // Reset selection
            selectedAvatar = null;
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('customAvatarUrl').value = '';
            
            // Open modal
            document.getElementById('avatarModal').style.display = 'block';
        }

        function selectAvatar(avatarUrl) {
            selectedAvatar = avatarUrl;
            
            // Update UI
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Find and highlight selected
            event.currentTarget.classList.add('selected');
            document.getElementById('customAvatarUrl').value = '';
        }

        function saveAvatar() {
            if (!auth.currentUser) return;
            
            const customUrl = document.getElementById('customAvatarUrl').value.trim();
            let avatarUrl = selectedAvatar;
            
            // Use custom URL if provided
            if (customUrl) {
                // Validate URL format
                if (customUrl.startsWith('http://') || customUrl.startsWith('https://')) {
                    avatarUrl = customUrl;
                } else {
                    alert('URL invalide! Veuillez entrer une URL complÃ¨te (http:// ou https://)');
                    return;
                }
            }
            
            if (!avatarUrl) {
                alert('Veuillez sÃ©lectionner un avatar ou entrer une URL personnalisÃ©e!');
                return;
            }
            
            console.log('Saving avatar URL:', avatarUrl);
            
            // Save to Firebase
            database.ref('avatars/' + auth.currentUser.uid).set(avatarUrl).then(() => {
                // Update UI
                document.getElementById('userAvatar').src = avatarUrl;
                closeModal('avatarModal');
                alert('Avatar sauvegardÃ© avec succÃ¨s!');
            }).catch((error) => {
                console.log('Mode test : simulation de sauvegarde');
                document.getElementById('userAvatar').src = avatarUrl;
                closeModal('avatarModal');
                alert('Avatar sauvegardÃ© (mode test)!');
            });
        }

        // Logout function
        function handleLogout() {
            if (confirm('ÃŠtes-vous sÃ»r de vouloir vous dÃ©connecter?')) {
                auth.signOut().then(() => {
                    console.log('DÃ©connexion rÃ©ussie');
                }).catch((error) => {
                    console.error('Erreur de dÃ©connexion:', error);
                    alert('Erreur lors de la dÃ©connexion');
                });
            }
        }


        // Check and show customization link
        function checkAndShowCustomizationLink() {
            if (currentUserRole !== 'member') {
                const customLink = document.createElement('a');
                customLink.href = '#';
                customLink.className = 'btn';
                customLink.style.cssText = 'position: fixed; top: 20px; right: 140px; background: #0066cc; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; z-index: 1000;';
                customLink.innerHTML = 'â—ˆ Personnaliser';
                customLink.id = 'customLink';
                customLink.onclick = openCustomizationModal;
                document.body.appendChild(customLink);
            }
        }

        // Hide admin link
        function hideAdminLink() {
            const adminLink = document.getElementById('adminLink');
            if (adminLink) {
                adminLink.remove();
            }
        }
        
        // Open customization modal
        function openCustomizationModal() {
            console.log('Opening customization modal...');
            const modal = document.getElementById('customizationModal');
            if (modal) {
                modal.style.display = 'block';
            } else {
                alert('Modal de personnalisation non trouvÃ©!');
            }
        }
        
        // Open username modal
        function openUsernameModal() {
            console.log('Opening username modal...');
            const modal = document.getElementById('customizationModal');
            if (modal) {
                modal.style.display = 'block';
                // Focus sur le champ pseudo
                setTimeout(() => {
                    const usernameInput = document.getElementById('newUsername');
                    if (usernameInput) {
                        usernameInput.focus();
                        usernameInput.select();
                    }
                }, 100);
            } else {
                alert('Modal de personnalisation non trouvÃ©!');
            }
        }
        
        // Save customization
        function saveCustomization() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ© pour personnaliser votre profil!');
                return;
            }
            
            const newUsername = document.getElementById('newUsername').value.trim();
            const usernameColor = document.getElementById('usernameColor').value;
            const usernameStyle = document.getElementById('usernameStyle').value;
            const usernameEffect = document.getElementById('usernameEffect').value;
            const customBadge = document.getElementById('customBadge').value;
            const badgeColor = document.getElementById('badgeColor').value;
            
            // Validation du pseudo
            if (newUsername && newUsername.length < 3) {
                alert('Le pseudo doit contenir au moins 3 caractÃ¨res!');
                return;
            }
            
            if (newUsername && newUsername.length > 20) {
                alert('Le pseudo ne doit pas dÃ©passer 20 caractÃ¨res!');
                return;
            }
            
            const customization = {
                usernameColor: usernameColor,
                usernameStyle: usernameStyle,
                usernameEffect: usernameEffect,
                customBadge: customBadge,
                badgeColor: badgeColor,
                updatedAt: new Date().toISOString()
            };
            
            // Sauvegarder la personnalisation
            database.ref('users/' + auth.currentUser.uid + '/customization').set(customization)
                .then(() => {
                    console.log('âœ… Personnalisation sauvegardÃ©e');
                    
                    // Si nouveau pseudo, le mettre Ã  jour
                    if (newUsername && newUsername !== auth.currentUser.displayName) {
                        return auth.currentUser.updateProfile({
                            displayName: newUsername
                        }).then(() => {
                            console.log('âœ… Pseudo mis Ã  jour');
                            // Mettre Ã  jour dans la base de donnÃ©es
                            return database.ref('users/' + auth.currentUser.uid + '/username').set(newUsername);
                        }).then(() => {
                            // Mettre Ã  jour l'interface
                            document.getElementById('userUsername').textContent = newUsername;
                            alert('Pseudo et personnalisation sauvegardÃ©s avec succÃ¨s!');
                        });
                    } else {
                        alert('Personnalisation sauvegardÃ©e avec succÃ¨s!');
                    }
                    
                    closeModal('customizationModal');
                    
                    // Apply customization immediately
                    applyCustomization(customization);
                })
                .catch((error) => {
                    console.error('âŒ Erreur lors de la sauvegarde:', error);
                    alert('Erreur lors de la sauvegarde de la personnalisation');
                });
        }
        
        // Reset customization
        function resetCustomization() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ© pour rÃ©initialiser votre profil!');
                return;
            }
            
            if (confirm('ÃŠtes-vous sÃ»r de vouloir rÃ©initialiser votre personnalisation?')) {
                // Reset to defaults
                document.getElementById('usernameColor').value = '#ffffff';
                document.getElementById('usernameStyle').value = 'normal';
                document.getElementById('usernameEffect').value = 'none';
                document.getElementById('customBadge').value = '';
                document.getElementById('badgeColor').value = '#ffd700';
                
                // Remove from Firebase
                database.ref('users/' + auth.currentUser.uid + '/customization').remove()
                    .then(() => {
                        console.log('âœ… Personnalisation rÃ©initialisÃ©e');
                        alert('Personnalisation rÃ©initialisÃ©e avec succÃ¨s!');
                        
                        // Apply defaults
                        applyCustomization({
                            usernameColor: '#ffffff',
                            usernameStyle: 'normal',
                            usernameEffect: 'none',
                            customBadge: '',
                            badgeColor: '#ffd700'
                        });
                    })
                    .catch((error) => {
                        console.error('âŒ Erreur lors de la rÃ©initialisation:', error);
                        alert('Erreur lors de la rÃ©initialisation');
                    });
            }
        }
        
        // Apply customization to UI
        function applyCustomization(customization) {
            const userUsername = document.getElementById('userUsername');
            if (userUsername) {
                userUsername.style.color = customization.usernameColor || '#ffffff';
                
                // Apply styles
                let fontWeight = 'normal';
                let fontStyle = 'normal';
                
                if (customization.usernameStyle === 'bold') fontWeight = 'bold';
                else if (customization.usernameStyle === 'italic') fontStyle = 'italic';
                else if (customization.usernameStyle === 'bold-italic') {
                    fontWeight = 'bold';
                    fontStyle = 'italic';
                }
                
                userUsername.style.fontWeight = fontWeight;
                userUsername.style.fontStyle = fontStyle;
                
                // Apply effects
                switch (customization.usernameEffect) {
                    case 'glow':
                        userUsername.style.textShadow = '0 0 10px ' + customization.usernameColor;
                        break;
                    case 'shadow':
                        userUsername.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
                        break;
                    case 'rainbow':
                        userUsername.style.background = 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)';
                        userUsername.style.webkitBackgroundClip = 'text';
                        userUsername.style.webkitTextFillColor = 'transparent';
                        break;
                    case 'neon':
                        userUsername.style.textShadow = '0 0 5px ' + customization.usernameColor + ', 0 0 10px ' + customization.usernameColor + ', 0 0 15px ' + customization.usernameColor;
                        break;
                    default:
                        userUsername.style.textShadow = 'none';
                        userUsername.style.background = 'none';
                        userUsername.style.webkitTextFillColor = 'unset';
                }
            }
            
            // Update global variable for chat
            currentUserUsernameColor = customization.usernameColor || '#ffffff';
        }
        
        // Initialize real-time data
        function initializeRealTimeData() {
            // Simulate connected users
            const userNames = ['Alex', 'Marie', 'Thomas', 'Sophie', 'Lucas', 'Emma', 'Nathan', 'LÃ©a'];
            const roles = ['admin', 'moderator', 'vip', 'member'];
            
            for (let i = 0; i < 5; i++) {
                connectedUsers.push({
                    name: userNames[Math.floor(Math.random() * userNames.length)] + Math.floor(Math.random() * 100),
                    role: roles[Math.floor(Math.random() * roles.length)],
                    status: 'online',
                    lastSeen: new Date()
                });
            }
            
            // Update online count with real users
            updateOnlineUsers();
        }
        
        function updateOnlineUsers() {
            const totalUsers = connectedUsers.length + 1; // +1 for current user
            document.getElementById('onlineCount').textContent = totalUsers;
            
            // Simulate users joining/leaving
            if (Math.random() > 0.8) {
                const randomUser = connectedUsers[Math.floor(Math.random() * connectedUsers.length)];
                if (Math.random() > 0.5) {
                    // User joins
                    if (randomUser.status === 'offline') {
                        randomUser.status = 'online';
                        updateOnlineUsers();
                    }
                } else {
                    // User leaves
                    if (randomUser.status === 'online') {
                        randomUser.status = 'offline';
                        updateOnlineUsers();
                    }
                }
            }
        }

        // Hide customization link
        function hideCustomizationLink() {
            const customLink = document.getElementById('customLink');
            if (customLink) {
                customLink.remove();
            }
        }

        // Create ADMIN role in Realtime Database and assign to user
        function createAdminRoleInDatabase() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ©!');
                return;
            }
            
            const userId = auth.currentUser.uid;
            const username = auth.currentUser.displayName || auth.currentUser.email.split('@')[0];
            const email = auth.currentUser.email;
            
            // Create/Update user with ADMIN role in Realtime Database
            const userData = {
                username: username,
                email: email,
                role: 'admin',
                createdAt: Date.now(),
                lastSeen: Date.now(),
                lastUpdated: Date.now(),
                isAdmin: true,
                permissions: ['admin', 'moderator', 'vip', 'member']
            };
            
            // Set user data in Realtime Database
            database.ref('users/' + userId).set(userData).then(() => {
                console.log('âœ… RÃ´le ADMIN crÃ©Ã© dans la Realtime Database pour:', username);
                
                // Also create in roles collection for reference
                database.ref('roles/' + userId).set({
                    role: 'admin',
                    username: username,
                    assignedBy: 'system',
                    assignedAt: Date.now()
                }).then(() => {
                    console.log('âœ… RÃ´le enregistrÃ© dans la collection roles');
                    
                    // Force update local variables
                    currentUserRole = 'admin';
                    updateUserProfile();
                    
                    alert(`ðŸŽ‰ RÃ´le ADMIN crÃ©Ã© et attribuÃ© Ã  ${username} dans la base de donnÃ©es!`);
                    
                    // Show database info
                    showDatabaseInfo(userId, userData);
                    
                    // Refresh page after 2 seconds
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                });
            }).catch((error) => {
                console.error('âŒ Erreur lors de la crÃ©ation du rÃ´le ADMIN:', error);
                alert('Erreur: ' + error.message);
            });
        }

        // Show database information
        function showDatabaseInfo(userId, userData) {
            console.log('ðŸ“Š Database Info:');
            console.log('User ID:', userId);
            console.log('Path: users/' + userId);
            console.log('Data:', userData);
            console.log('Realtime Database URL: https://doomsday-forums-default-rtdb.europe-west1.firebasedatabase.app/users/' + userId);
        }

        // Database diagnostic function
        function diagnoseDatabase() {
            console.log('ðŸ” DIAGNOSTIC COMPLET DE LA BASE DE DONNÃ‰ES');
            
            if (!auth.currentUser) {
                console.error('âŒ Utilisateur non connectÃ©');
                alert('Vous devez Ãªtre connectÃ© pour diagnostiquer la base de donnÃ©es!');
                return;
            }
            
            const userId = auth.currentUser.uid;
            const username = auth.currentUser.displayName || auth.currentUser.email.split('@')[0];
            
            console.log('ðŸ“Š User ID:', userId);
            console.log('ðŸ“Š Username:', username);
            console.log('ðŸ“Š Current role variable:', currentUserRole);
            
            // Check user data in database
            database.ref('users/' + userId).once('value').then((snapshot) => {
                const userData = snapshot.val();
                console.log('ðŸ“Š DonnÃ©es utilisateur dans BDD:', userData);
                
                if (userData) {
                    console.log('âœ… Utilisateur trouvÃ© dans la base de donnÃ©es');
                    console.log('ðŸ“Š RÃ´le dans BDD:', userData.role);
                    console.log('ðŸ“Š Email dans BDD:', userData.email);
                    console.log('ðŸ“Š Username dans BDD:', userData.username);
                    
                    if (userData.role !== 'admin') {
                        console.log('âš ï¸ LE RÃ”LE DANS LA BASE DE DONNÃ‰ES N\'EST PAS ADMIN!');
                        console.log('ðŸ”§ Tentative de correction...');
                        
                        // Force correction
                        return database.ref('users/' + userId).update({
                            role: 'admin',
                            lastUpdated: Date.now(),
                            forceCorrected: true
                        });
                    } else {
                        console.log('âœ… RÃ´le admin correct dans la base de donnÃ©es');
                    }
                } else {
                    console.log('âŒ Utilisateur non trouvÃ© dans la base de donnÃ©es!');
                    console.log('ðŸ”§ CrÃ©ation de l\'utilisateur avec rÃ´le admin...');
                    
                    // Create user with admin role
                    const newUserData = {
                        username: username,
                        email: auth.currentUser.email,
                        role: 'admin',
                        createdAt: Date.now(),
                        lastSeen: Date.now(),
                        lastUpdated: Date.now(),
                        forceCreated: true
                    };
                    
                    return database.ref('users/' + userId).set(newUserData);
                }
            }).then(() => {
                console.log('âœ… Base de donnÃ©es corrigÃ©e avec succÃ¨s!');
                
                // Verify the fix
                return database.ref('users/' + userId).once('value');
            }).then((snapshot) => {
                const correctedData = snapshot.val();
                console.log('ðŸ” VÃ©rification aprÃ¨s correction:', correctedData);
                
                if (correctedData && correctedData.role === 'admin') {
                    alert('âœ… Base de donnÃ©es diagnostiquÃ©e et corrigÃ©e! RÃ´le Admin confirmÃ©.');
                } else {
                    alert('âŒ ProblÃ¨me persiste dans la base de donnÃ©es.');
                }
            }).catch((error) => {
                console.error('âŒ Erreur lors du diagnostic:', error);
                alert('âŒ Erreur base de donnÃ©es: ' + error.message);
            });
        }

        // Add diagnostic button
        function addDiagnosticButton() {
            const diagBtn = document.createElement('button');
            diagBtn.innerHTML = 'ðŸ” DIAGNOSTIC BDD';
            diagBtn.style.cssText = 'position: fixed; bottom: 250px; right: 20px; background: #ff6600; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; z-index: 1004; font-weight: bold;';
            diagBtn.onclick = diagnoseDatabase;
            diagBtn.id = 'diagnosticBtn';
            document.body.appendChild(diagBtn);
        }

        // Add immediate force update button
        function addImmediateForceButton() {
            const forceBtn = document.createElement('button');
            forceBtn.innerHTML = 'âš¡ FORCAGE IMMÃ‰DIAT';
            forceBtn.style.cssText = 'position: fixed; bottom: 200px; right: 20px; background: #ff00ff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; z-index: 1003; font-weight: bold; animation: pulse 2s infinite;';
            forceBtn.onclick = forceImmediateUpdate;
            forceBtn.id = 'immediateForceBtn';
            document.body.appendChild(forceBtn);
        }

        function forceImmediateUpdate() {
            console.log('âš¡ FORÃ‡AGE IMMÃ‰DIAT DÃ‰CLANCHÃ‰');
            
            // FORCE EVERYTHING - NO EXCEPTIONS
            currentUserRole = 'admin';
            
            // Update UI immediately with multiple checks
            const roleElement = document.getElementById('userRole');
            if (roleElement) {
                roleElement.textContent = 'ADMIN';
                roleElement.style.color = '#ff0000';
                roleElement.style.fontWeight = 'bold';
                roleElement.style.textTransform = 'uppercase';
                roleElement.style.fontSize = '0.9rem';
                console.log('âœ… RÃ´le ADMIN forcÃ© dans l\'UI');
            } else {
                console.log('â„¹ï¸ Ã‰lÃ©ment userRole non trouvÃ© (normal si pas dans le profil)');
            }
            
            // Update user profile display
            if (currentUser) {
                updateUserProfile();
                console.log('âœ… Profil utilisateur mis Ã  jour');
            }
            
            // Show admin link if admin
            if (currentUserRole === 'admin') {
                checkAndShowAdminLink();
                console.log('âœ… Lien admin affichÃ©');
            }
            
            console.log('âš¡ ForÃ§age immÃ©diat terminÃ©');
        }

        // Add database admin button
        function addDatabaseAdminButton() {
            const dbBtn = document.createElement('button');
            dbBtn.innerHTML = 'ðŸ—„ï¸ CrÃ©er ADMIN DB';
            dbBtn.style.cssText = 'position: fixed; bottom: 150px; right: 20px; background: #00aa00; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; z-index: 1002; font-weight: bold;';
            dbBtn.onclick = createAdminRoleInDatabase;
            dbBtn.id = 'dbAdminBtn';
            document.body.appendChild(dbBtn);
        }

        // Force update user role in database
        function forceUpdateRoleToAdmin() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ©!');
                return;
            }
            
            const userId = auth.currentUser.uid;
            const username = auth.currentUser.displayName || auth.currentUser.email.split('@')[0];
            
            // Update role in database
            database.ref('users/' + userId).update({
                role: 'admin',
                username: username,
                lastUpdated: Date.now()
            }).then(() => {
                console.log('RÃ´le mis Ã  jour dans la base de donnÃ©es: admin');
                alert('âœ… RÃ´le Admin mis Ã  jour dans la base de donnÃ©es!');
                
                // Force reload user role
                currentUserRole = 'admin';
                updateUserProfile();
                
                // Refresh the page to see changes
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }).catch((error) => {
                console.error('Erreur lors de la mise Ã  jour du rÃ´le:', error);
                alert('Erreur: ' + error.message);
            });
        }

        // Add temporary button for debugging
        function addDebugButton() {
            const debugBtn = document.createElement('button');
            debugBtn.innerHTML = 'ðŸ”§ Forcer Admin';
            debugBtn.style.cssText = 'position: fixed; bottom: 100px; right: 20px; background: #ff6600; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; z-index: 1001;';
            debugBtn.onclick = forceUpdateRoleToAdmin;
            debugBtn.id = 'debugAdminBtn';
            document.body.appendChild(debugBtn);
        }

        // Load user role from database
        function loadUserRole(userId) {
            database.ref('users/' + userId).once('value').then((snapshot) => {
                const userData = snapshot.val();
                console.log('ðŸ“Š Database user data:', userData);
                
                if (userData && userData.role) {
                    console.log('Database role found:', userData.role);
                    // DON'T OVERRIDE - keep forced admin role
                    // currentUserRole = userData.role; 
                    currentUserRole = 'admin'; // Keep admin forced
                    console.log('ðŸ”¥ Keeping FORCED ADMIN role - Database ignored');
                } else {
                    currentUserRole = 'admin';
                    console.log('No database role, using admin');
                }
                
                console.log('Final role:', currentUserRole);
                
                // Don't update currentUser here - it should stay as username
                updateOnlineUsersInFirebase();
                
                // Check admin link after role is loaded
                checkAndShowAdminLink();
            }).catch((error) => {
                console.log('Database error, keeping forced admin role');
                currentUserRole = 'admin';
                checkAndShowAdminLink();
            });
        }

        // Thread click handler
        function openThread(threadId) {
            console.log('Opening thread:', threadId);
            alert('Ouverture du fil de discussion ' + threadId + ' (Simulation)');
        }

        // Chat functions

        function toggleChat() {
            console.log('toggleChat appelÃ©');
            
            const chatSection = document.getElementById('chatSection');
            const chatToggle = document.getElementById('chatToggle');
            
            if (!chatSection || !chatToggle) {
                console.error('Ã‰lÃ©ments du chat non trouvÃ©s');
                return;
            }
            
            // Toggle sans utiliser la variable chatOpen du tout
            if (chatSection.classList.contains('chat-hidden')) {
                // Open chat
                chatSection.classList.remove('chat-hidden');
                chatToggle.classList.add('chat-hidden');
                document.getElementById('chatInput').focus();
                console.log('Chat ouvert');
            } else {
                // Close chat
                chatSection.classList.add('chat-hidden');
                chatToggle.classList.remove('chat-hidden');
                console.log('Chat fermÃ©');
            }
        }

        function updateUserRole() {
            // Function simplified since role selector was removed
            currentUserRole = 'admin';
            console.log('RÃ´le maintenu: ADMIN');
        }

        function insertEmoji(emoji) {
            const input = document.getElementById('chatInput');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            
            input.value = text.substring(0, start) + emoji + text.substring(end);
            input.selectionStart = input.selectionEnd = start + emoji.length;
            input.focus();
        }

        function toggleColorPicker() {
            const picker = document.getElementById('colorPicker');
            picker.classList.toggle('show');
        }

        function changeUsernameColor(color) {
            if (auth.currentUser) {
                // Save color to Firebase
                database.ref('users/' + auth.currentUser.uid).update({
                    usernameColor: color
                }).then(() => {
                    console.log('Couleur du pseudo mise Ã  jour:', color);
                    toggleColorPicker();
                    // Update current user color
                    currentUserUsernameColor = color;
                }).catch((error) => {
                    console.error('Erreur lors de la mise Ã  jour de la couleur:', error);
                });
            }
        }

        function viewProfile(username) {
            alert(`Profil de ${username} - (FonctionnalitÃ© Ã  implÃ©menter)`);
        }

        function replyToMessage(username, messageId) {
            const input = document.getElementById('chatInput');
            input.value = `@${username} `;
            input.focus();
            replyingTo = messageId;
        }

        function processMentions(text) {
            // Find all @mentions in the text
            const mentionRegex = /@(\w+)/g;
            return text.replace(mentionRegex, '<span class="mention" onclick="viewProfile(\'$1\')">@$1</span>');
        }

        function addMessageFromFirebase(author, text, time, avatarUrl) {
            console.log('addMessageFromFirebase appelÃ© avec:', {author, text, time, avatarUrl});
            
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) {
                console.log('â„¹ï¸ Chat non disponible - message ignorÃ©:', {author, text});
                return; // Ne pas afficher d'erreur, juste ignorer
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.dataset.messageId = Date.now() + Math.random(); // Unique ID for replies
            
            // Get user role and color
            let userRole = 'member';
            let usernameColor = '#ffffff';
            let userAvatar = avatarUrl;
            
            // Fetch user data from Firebase
            if (author && database) {
                database.ref('users').orderByChild('username').equalTo(author).once('value').then((snapshot) => {
                    const users = snapshot.val();
                    if (users) {
                        const userId = Object.keys(users)[0];
                        const userData = users[userId];
                        userRole = userData.role || 'member';
                        usernameColor = userData.usernameColor || '#ffffff';
                        
                        // Also fetch avatar from avatars collection
                        database.ref('avatars/' + userId).once('value').then((avatarSnapshot) => {
                            userAvatar = avatarSnapshot.val() || avatarUrl;
                            // Update message with role, color and avatar
                            updateMessageWithUserData(messageDiv, author, text, time, userAvatar, userRole, usernameColor);
                        }).catch(() => {
                            // Fallback if avatar fetch fails
                            updateMessageWithUserData(messageDiv, author, text, time, avatarUrl, userRole, usernameColor);
                        });
                    } else {
                        // Fallback if user not found
                        updateMessageWithUserData(messageDiv, author, text, time, avatarUrl, userRole, usernameColor);
                    }
                }).catch(() => {
                    // Fallback if Firebase fails
                    updateMessageWithUserData(messageDiv, author, text, time, avatarUrl, userRole, usernameColor);
                });
            } else {
                // Immediate update if no author or database
                updateMessageWithUserData(messageDiv, author, text, time, avatarUrl, userRole, usernameColor);
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function updateMessageWithUserData(messageDiv, author, text, time, avatarUrl, userRole, usernameColor) {
            // Create avatar HTML with real profile photo
            let avatarHTML = '';
            if (avatarUrl && avatarUrl !== null && avatarUrl !== undefined) {
                // Validate avatar URL
                if (avatarUrl.startsWith('http://') || avatarUrl.startsWith('https://')) {
                    avatarHTML = `
                        <div class="message-avatar" onclick="viewProfile('${sanitizeInput(author)}')" style="cursor: pointer;">
                            <img src="${avatarUrl}" alt="${sanitizeInput(author)}" 
                                 onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='${sanitizeInput(author).substring(0, 2).toUpperCase()}';"
                                 loading="lazy">
                        </div>
                    `;
                } else {
                    // Invalid URL, use initials
                    const initials = author ? author.substring(0, 2).toUpperCase() : '??';
                    avatarHTML = `
                        <div class="message-avatar" onclick="viewProfile('${sanitizeInput(author)}')" style="cursor: pointer;">
                            ${initials}
                        </div>
                    `;
                }
            } else {
                // No avatar URL, use initials
                const initials = author ? author.substring(0, 2).toUpperCase() : '??';
                avatarHTML = `
                    <div class="message-avatar" onclick="viewProfile('${sanitizeInput(author)}')" style="cursor: pointer;">
                        ${initials}
                    </div>
                `;
            }
            
            // Process mentions in text
            const processedText = processMentions(text);
            
            // Determine username class based on role
            let usernameClass = 'username';
            if (userRole === 'admin') {
                usernameClass += ' admin';
            } else if (userRole === 'moderator') {
                usernameClass += ' moderator';
            }
            
            messageDiv.innerHTML = `
                <div class="message-author">
                    ${avatarHTML}
                    <span class="${usernameClass}" style="color: ${usernameColor};" onclick="viewProfile('${sanitizeInput(author)}')">${sanitizeInput(author)}</span>
                </div>
                <div class="message-text">${processedText}</div>
                <div class="message-time">${time}</div>
            `;
        }

        function sendMessage() {
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const input = document.getElementById('chatInput');
            if (!input) {
                console.log('â„¹ï¸ Chat non disponible - envoi message annulÃ©');
                return;
            }
            
            const message = input.value.trim();
            
            if (message === '') {
                console.log('Message vide, envoi annulÃ©');
                return;
            }
            
            if (!auth.currentUser) {
                console.log('Utilisateur non connectÃ©, envoi annulÃ©');
                addMessageFromFirebase('System', 'Vous devez Ãªtre connectÃ© pour envoyer des messages!', 'Maintenant');
                return;
            }
            
            console.log('Envoi du message:', message);
            
            const messageData = {
                user: currentUser || 'Utilisateur',
                text: message,
                timestamp: Date.now()
            };
            
            input.value = '';
            
            database.ref('messages').push(messageData)
                .then(() => {
                    console.log('Message envoyÃ© avec succÃ¨s Ã  Firebase');
                })
                .catch((error) => {
                    console.error('Erreur Firebase:', error);
                    throw error;
                });
        }

        // #FONCTIONNALITÃ‰S FORUM - CRÃ‰ATION DE SUJETS#
        
        // CrÃ©er un nouveau sujet
        function createThread() {
            if (!auth.currentUser) {
                alert('Vous devez Ãªtre connectÃ© pour crÃ©er un sujet!');
                return;
            }
            
            const title = document.getElementById('threadTitle').value.trim();
            const category = document.getElementById('threadCategory').value;
            const content = document.getElementById('threadContent').value.trim();
            const tags = document.getElementById('threadTags').value.trim();
            
            // Validation
            if (!title) {
                alert('Veuillez entrer un titre pour votre sujet!');
                return;
            }
            
            if (!category) {
                alert('Veuillez choisir une catÃ©gorie!');
                return;
            }
            
            if (!content) {
                alert('Veuillez entrer le contenu de votre sujet!');
                return;
            }
            
            if (title.length < 5) {
                alert('Le titre doit contenir au moins 5 caractÃ¨res!');
                return;
            }
            
            if (content.length < 20) {
                alert('Le contenu doit contenir au moins 20 caractÃ¨res!');
                return;
            }
            
            // CrÃ©er le sujet dans Firebase
            const threadData = {
                title: title,
                category: category,
                content: content,
                tags: tags ? tags.split(',').map(tag => tag.trim()) : [],
                author: currentUser || 'Utilisateur',
                authorId: auth.currentUser.uid,
                createdAt: Date.now(),
                replies: 0,
                views: 0,
                lastActivity: Date.now(),
                pinned: false,
                locked: false
            };
            
            database.ref('threads').push(threadData)
                .then(() => {
                    console.log('âœ… Sujet crÃ©Ã© avec succÃ¨s');
                    alert('Sujet crÃ©Ã© avec succÃ¨s!');
                    
                    // Vider le formulaire
                    document.getElementById('threadTitle').value = '';
                    document.getElementById('threadCategory').value = '';
                    document.getElementById('threadContent').value = '';
                    document.getElementById('threadTags').value = '';
                    
                    // RafraÃ®chir la liste des sujets
                    loadLatestThreads();
                    
                    // Notifier l'utilisateur
                    showNotification('Nouveau sujet crÃ©Ã©: ' + title, 'success');
                })
                .catch((error) => {
                    console.error('âŒ Erreur lors de la crÃ©ation du sujet:', error);
                    alert('Erreur lors de la crÃ©ation du sujet: ' + error.message);
                });
        }
        
        // Charger les derniers sujets
        function loadLatestThreads() {
            database.ref('threads').orderByChild('lastActivity').limitToLast(10).once('value')
                .then((snapshot) => {
                    const threads = snapshot.val();
                    const threadList = document.getElementById('threadList');
                    
                    if (!threadList) return;
                    
                    threadList.innerHTML = '';
                    
                    if (threads) {
                        Object.values(threads).reverse().forEach(thread => {
                            const threadItem = createThreadItem(thread);
                            threadList.appendChild(threadItem);
                        });
                    }
                })
                .catch((error) => {
                    console.error('âŒ Erreur lors du chargement des sujets:', error);
                });
        }
        
        // Calculer le temps Ã©coulÃ©
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
            if (hours < 24) return `${hours} heure${hours > 1 ? 's' : ''}`;
            return `${days} jour${days > 1 ? 's' : ''}`;
        }
        
        // CrÃ©er un Ã©lÃ©ment de sujet
        function createThreadItem(thread) {
            const li = document.createElement('li');
            li.className = 'thread-item';
            li.onclick = () => openThread(thread.id || thread.key);
            
            const timeAgo = getTimeAgo(thread.lastActivity);
            const tagsHtml = thread.tags && thread.tags.length > 0 
                ? `<div class="thread-tags">${thread.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>`
                : '';
            
            li.innerHTML = `
                <div class="thread-title">${sanitizeInput(thread.title)}</div>
                <div class="thread-meta">
                    <span class="thread-author" onclick="viewProfile('${thread.author}'); event.stopPropagation();">Par ${sanitizeInput(thread.author)}</span>
                    <div class="thread-stats">
                        <span>${thread.replies || 0} rÃ©ponses</span>
                        <span>${thread.views || 0} vues</span>
                        <span>il y a ${timeAgo}</span>
                    </div>
                </div>
                ${tagsHtml}
            `;
            
            return li;
        }
        
        // Afficher une notification
        function showNotification(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.innerHTML = `
                <div class="toast-content">${message}</div>
                <div class="toast-time">${new Date().toLocaleTimeString('fr-FR')}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-suppression aprÃ¨s 5 secondes
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        function handleChatKeyPress(event) {
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const input = document.getElementById('chatInput');
            if (!input) {
                console.log('â„¹ï¸ Chat non disponible - touche ignorÃ©e');
                return;
            }
            
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function addMessage(author, text) {
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) {
                console.log('â„¹ï¸ Chat non disponible - message ignorÃ©:', {author, text});
                return; // Ne pas afficher d'erreur, juste ignorer
            }
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            
            // Create avatar HTML
            let avatarHTML = '';
            const initials = author ? author.substring(0, 2).toUpperCase() : '??';
            avatarHTML = `
                <div class="message-avatar">
                    ${initials}
                </div>
            `;
            
            messageDiv.innerHTML = `
                <div class="message-author">
                    ${avatarHTML}
                    ${sanitizeInput(author)}
                </div>
                <div class="message-text">${sanitizeInput(text)}</div>
                <div class="message-time">${time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // #FONCTIONNALITÃ‰S ADMIN - GESTION#
        
        // Afficher le lien admin si l'utilisateur est admin
        function checkAndShowAdminLink() {
            if (currentUserRole === 'admin') {
                const adminLink = document.createElement('a');
                adminLink.href = 'admin.html';
                adminLink.className = 'btn';
                adminLink.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #ff0000; color: white; padding: 4px 10px; text-decoration: none; border-radius: 3px; z-index: 1000; font-size: 0.7rem;';
                adminLink.innerHTML = 'ðŸ”§ Admin';
                adminLink.id = 'adminLink';
                document.body.appendChild(adminLink);
                console.log('âœ… Lien admin crÃ©Ã© et affichÃ©');
            }
        }
        
        function hideAdminLink() {
            const adminLink = document.getElementById('adminLink');
            if (adminLink) {
                adminLink.remove();
            }
        }

        function hideCustomizationLink() {
            const customLink = document.getElementById('customLink');
            if (customLink) {
                customLink.remove();
            }
        }

        // #SYSTÃˆME DE VÃ‰RIFICATION AUTOMATIQUE DU CODE#
        
        // VÃ©rifier toutes les fonctions critiques avant exÃ©cution
        function validateCodeBeforeExecution() {
            const criticalFunctions = [
                'checkAndShowAdminLink',
                'hideAdminLink', 
                'forceImmediateUpdate',
                'initializeFirebaseWithRetry',
                'sanitizeInput',
                'validateEmail',
                'validatePassword'
            ];
            
            const missingFunctions = [];
            const duplicateElements = [];
            
            // VÃ©rifier les fonctions manquantes
            criticalFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missingFunctions.push(funcName);
                }
            });
            
            // VÃ©rifier les Ã©lÃ©ments dupliquÃ©s
            const adminLinks = document.querySelectorAll('#adminLink');
            if (adminLinks.length > 1) {
                duplicateElements.push('adminLink');
            }
            
            const debugBtns = document.querySelectorAll('#debugAdminBtn');
            if (debugBtns.length > 1) {
                duplicateElements.push('debugAdminBtn');
            }
            
            const dbBtns = document.querySelectorAll('#dbAdminBtn');
            if (dbBtns.length > 1) {
                duplicateElements.push('dbAdminBtn');
            }
            
            // Nettoyer les doublons
            duplicateElements.forEach(elementId => {
                const elements = document.querySelectorAll(`#${elementId}`);
                for (let i = 1; i < elements.length; i++) {
                    elements[i].remove();
                    console.warn(`ðŸ§¹ Ã‰lÃ©ment dupliquÃ© supprimÃ©: ${elementId}`);
                }
            });
            
            // Afficher les rÃ©sultats
            if (missingFunctions.length > 0) {
                console.error('âŒ Fonctions manquantes:', missingFunctions);
                return false;
            }
            
            if (duplicateElements.length > 0) {
                console.warn('âš ï¸ Ã‰lÃ©ments dupliquÃ©s nettoyÃ©s:', duplicateElements);
            }
            
            console.log('âœ… Validation du code rÃ©ussie');
            return true;
        }
        
        // SystÃ¨me de vÃ©rification unique pour le bouton admin
        function ensureSingleAdminButton() {
            // Supprimer tous les boutons admin existants
            const existingAdminButtons = [
                ...document.querySelectorAll('#adminLink'),
                ...document.querySelectorAll('#debugAdminBtn'),
                ...document.querySelectorAll('#dbAdminBtn'),
                ...document.querySelectorAll('.admin-debug-btn'),
                ...document.querySelectorAll('[onclick*="Admin"]')
            ];
            
            existingAdminButtons.forEach(btn => {
                if (btn && btn.parentNode) {
                    btn.remove();
                    console.log('ðŸ—‘ï¸ Bouton admin existant supprimÃ©');
                }
            });
            
            // CrÃ©er UN SEUL bouton admin si l'utilisateur est admin
            if (currentUserRole === 'admin' && !document.getElementById('adminLink')) {
                const adminLink = document.createElement('a');
                adminLink.href = 'admin.html';
                adminLink.className = 'btn';
                adminLink.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #ff0000; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; z-index: 1000; font-size: 0.8rem; font-weight: bold; box-shadow: 0 2px 10px rgba(255,0,0,0.3); transition: all 0.3s;';
                adminLink.innerHTML = 'ðŸ”§ Admin';
                adminLink.id = 'adminLink';
                
                // Effet hover
                adminLink.addEventListener('mouseenter', () => {
                    adminLink.style.background = '#cc0000';
                    adminLink.style.transform = 'scale(1.05)';
                });
                
                adminLink.addEventListener('mouseleave', () => {
                    adminLink.style.background = '#ff0000';
                    adminLink.style.transform = 'scale(1)';
                });
                
                document.body.appendChild(adminLink);
                console.log('âœ… Unique bouton admin crÃ©Ã©');
            }
        }
        
        // Remplacer toutes les fonctions de crÃ©ation de boutons admin
        function checkAndShowAdminLink() {
            ensureSingleAdminButton();
        }
        
        // Update online count periodically

        // Add some initial messages with roles
        setTimeout(() => {
            addMessage('Admin42', 'Salut tout le monde!', 'admin');
        }, 2000);

        setTimeout(() => {
            addMessage('ModoAlex', 'Bienvenue sur le chat!', 'moderator');
        }, 4000);

        setTimeout(() => {
            addMessage('VIPStar', 'Ce site est awesome!', 'vip');
        }, 6000);

        // Real-time synchronization simulation
        // Functions moved to global scope to avoid ReferenceError
        
        function addSystemMessage(message) {
            // VÃ©rifier si le chat est activÃ© avant de continuer
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) {
                console.log('â„¹ï¸ Chat non disponible - message systÃ¨me ignorÃ©:', message);
                return; // Ne pas afficher d'erreur, juste ignorer
            }
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.borderLeft = '3px solid #ffcc00';
            
            const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-author" style="color: #ffcc00;">SystÃ¨me</div>
                <div class="message-text">${message}</div>
                <div class="message-time">${time}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function simulateForumActivity() {
            const threadItems = document.querySelectorAll('.thread-item');
            threadItems.forEach((thread, index) => {
                if (Math.random() > 0.7) {
                    const stats = thread.querySelector('.thread-stats');
                    const replies = stats.querySelector('span:first-child');
                    const currentReplies = parseInt(replies.textContent);
                    
                    // Increment replies
                    replies.textContent = `${currentReplies + 1} rÃ©ponses`;
                    
                    // Update time
                    const times = ['il y a quelques minutes', 'il y a 1 minute', 'Ã  l\'instant'];
                    const timeSpan = stats.querySelector('span:last-child');
                    timeSpan.textContent = times[Math.floor(Math.random() * times.length)];
                    
                    // Highlight updated thread
                    thread.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
                    setTimeout(() => {
                        thread.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
                    }, 2000);
                }
            });
        }
        
        function simulateUserActivity() {
            // Simulate other users typing
            if (Math.random() > 0.9) {
                const randomUser = connectedUsers.find(u => u.status === 'online');
                if (randomUser) {
                    addMessage(randomUser.name, generateRandomMessage(), randomUser.role);
                }
            }
        }
        
        function generateRandomMessage() {
            const messages = [
                'Salut tout le monde !',
                'Quelqu\'un est lÃ  ?',
                'Ce site est gÃ©nial !',
                'Je suis nouveau ici',
                'Bonjour la communautÃ© !',
                'IntÃ©ressant cette discussion...',
                'Quelqu\'un veut discuter ?',
                'PremiÃ¨re fois que je visite',
                'Love le design !',
                'Forum trÃ¨s actif aujourd\'hui'
            ];
            return messages[Math.floor(Math.random() * messages.length)];
        }
        
        function broadcastActivity(activity) {
            // Simulate broadcasting to all connected users
            console.log('Broadcasting:', activity);
            
            // In a real implementation, this would send data via WebSocket
            // For now, we just simulate local effects
        }
        
        // Initialize real-time features
        initializeRealTimeData();
        
        // Start real-time simulations
        setInterval(updateOnlineUsers, 10000); // Update users every 10 seconds
        setInterval(simulateForumActivity, 15000); // Forum activity every 15 seconds
        setInterval(simulateUserActivity, 8000); // User messages every 8 seconds
        
                
        // Add connection notification
        setTimeout(() => {
            addSystemMessage('ConnectÃ© au serveur en temps rÃ©el');
        }, 1000);
        let lastVersion = localStorage.getItem('siteVersion') || '0';
        let currentVersion = '1.4.1'; // Auto-admin role for Neyzoxx
        
        function checkForUpdates() {
            if (lastVersion !== currentVersion) {
                localStorage.setItem('siteVersion', currentVersion);
                if (lastVersion !== '0') {
                    // Show update notification
                    const updateNotification = document.createElement('div');
                    updateNotification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: linear-gradient(135deg, #ff0000, #cc0000);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 10px;
                        font-weight: bold;
                        z-index: 10000;
                        box-shadow: 0 5px 20px rgba(255, 0, 0, 0.4);
                        animation: slideDown 0.5s ease-out;
                    `;
                    updateNotification.innerHTML = `
                        ðŸ”„ Mise Ã  jour disponible ! 
                        <button onclick="location.reload()" style="
                            background: white;
                            color: #ff0000;
                            border: none;
                            padding: 5px 15px;
                            border-radius: 5px;
                            margin-left: 10px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Actualiser</button>
                    `;
                    document.body.appendChild(updateNotification);
                    
                    // Auto-remove after 10 seconds
                    setTimeout(() => {
                        if (updateNotification.parentNode) {
                            updateNotification.remove();
                        }
                    }, 10000);
                }
            }
        }

        // Check for updates on page load
        checkForUpdates();

        // Check for updates every 5 minutes
        setInterval(checkForUpdates, 300000);

        // Add slide down animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translate(-50%, -100px);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // Add some dynamic behavior
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effect to threads
            const threads = document.querySelectorAll('.thread-item');
            threads.forEach(thread => {
                thread.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = 'rgba(255, 0, 0, 0.2)';
                });
                thread.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
                });
            });

            // Simulate real-time updates
            setInterval(function() {
                const stats = document.querySelectorAll('.thread-stats span:last-child');
                const times = ['il y a quelques minutes', 'il y a 1 heure', 'il y a 3 heures'];
                stats.forEach(stat => {
                    if (Math.random() > 0.7) {
                        stat.textContent = times[Math.floor(Math.random() * times.length)];
                    }
                });
            }, 30000); // Update every 30 seconds
        });

        // View user profile
        function viewProfile(username) {
            if (!username) {
                console.error('âŒ No username provided');
                return;
            }
            
            console.log('ðŸ”„ Opening profile for:', username);
            window.open(`public-profile.html?username=${encodeURIComponent(username)}`, '_blank');
        }

        // Open category
        function openCategory(category) {
            console.log('ðŸ”„ Opening category:', category);
            
            // Redirect to category posts page
            window.location.href = `category-posts.html?category=${encodeURIComponent(category)}`;
        }

        // Make online users clickable
        function makeOnlineUsersClickable() {
            const onlineUsersList = document.getElementById('onlineUsersList');
            if (onlineUsersList) {
                const users = onlineUsersList.querySelectorAll('.online-user');
                users.forEach(user => {
                    user.style.cursor = 'pointer';
                    user.addEventListener('click', function() {
                        const username = this.textContent.trim();
                        viewProfile(username);
                    });
                    user.addEventListener('mouseenter', function() {
                        this.style.color = '#ff6666';
                        this.style.textDecoration = 'underline';
                    });
                    user.addEventListener('mouseleave', function() {
                        this.style.color = '#00ff00';
                        this.style.textDecoration = 'none';
                    });
                });
            }
        }

        // Initialize clickable elements
        function initializeClickableElements() {
            // Make thread authors clickable
            const threadAuthors = document.querySelectorAll('.thread-author');
            threadAuthors.forEach(author => {
                author.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const username = this.textContent.replace('Par ', '');
                    viewProfile(username);
                });
            });
            
            // Make online users clickable
            makeOnlineUsersClickable();
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeClickableElements();
            
            // Re-initialize when chat is opened
            const chatToggle = document.getElementById('chatToggle');
            if (chatToggle) {
                chatToggle.addEventListener('click', function() {
                    setTimeout(makeOnlineUsersClickable, 1000);
                });
            }
            
            // Create sample posts for demonstration
            createSamplePosts();
        });

        // Create sample posts for demonstration
        function createSamplePosts() {
            const samplePosts = [
                {
                    title: "Bienvenue dans la section GÃ©nÃ©ral",
                    content: "Cette section est dÃ©diÃ©e aux discussions gÃ©nÃ©rales sur la cybersÃ©curitÃ©. N'hÃ©sitez pas Ã  partager vos connaissances, poser des questions et participer aux dÃ©bats!",
                    author: "Admin",
                    category: "general",
                    tags: ["gÃ©nÃ©ral", "bienvenue", "cybersÃ©curitÃ©"],
                    createdAt: Date.now() - 86400000, // 1 day ago
                    views: 156,
                    likes: 12,
                    replies: 8,
                    likedBy: {}
                },
                {
                    title: "Meilleures pratiques pour sÃ©curiser une base de donnÃ©es",
                    content: "Je voudrais partager quelques techniques essentielles pour sÃ©curiser vos bases de donnÃ©es : 1. Chiffrement des donnÃ©es sensibles 2. ContrÃ´le d'accÃ¨s granulaire 3. Audits rÃ©guliers 4. Sauvegardes sÃ©curisÃ©es...",
                    author: "SecurityExpert",
                    category: "database",
                    tags: ["database", "sÃ©curitÃ©", "best-practices"],
                    createdAt: Date.now() - 172800000, // 2 days ago
                    views: 89,
                    likes: 15,
                    replies: 23,
                    likedBy: {}
                },
                {
                    title: "Top 10 outils de pentest gratuits",
                    content: "Voici ma sÃ©lection des meilleurs outils de pentest gratuits : 1. Nmap pour le scanning rÃ©seau 2. Burp Suite pour les tests web 3. Wireshark pour l'analyse rÃ©seau 4. Metasploit Framework...",
                    author: "PentestPro",
                    category: "tools",
                    tags: ["pentest", "outils", "gratuit"],
                    createdAt: Date.now() - 259200000, // 3 days ago
                    views: 234,
                    likes: 28,
                    replies: 45,
                    likedBy: {}
                },
                {
                    title: "Comment dÃ©tecter une attaque MITM",
                    content: "Les attaques Man-in-the-Middle sont parmi les plus dangereuses. Voici comment les dÃ©tecter : 1. Surveillance du trafic anormal 2. VÃ©rification des certificats SSL 3. Analyse des temps de rÃ©ponse...",
                    author: "NetworkGuru",
                    category: "network",
                    tags: ["rÃ©seau", "MITM", "sÃ©curitÃ©"],
                    createdAt: Date.now() - 345600000, // 4 days ago
                    views: 178,
                    likes: 19,
                    replies: 31,
                    likedBy: {}
                },
                {
                    title: "Injection SQL : Guide complet",
                    content: "Les injections SQL restent une menace majeure. Ce guide couvre : 1. Types d'injections SQL 2. Techniques de dÃ©tection 3. MÃ©thodes de prÃ©vention 4. Outils d'audit...",
                    author: "WebSecMaster",
                    category: "web",
                    tags: ["SQL", "injection", "web", "sÃ©curitÃ©"],
                    createdAt: Date.now() - 432000000, // 5 days ago
                    views: 312,
                    likes: 34,
                    replies: 67,
                    likedBy: {}
                },
                {
                    title: "Analyse d'un ransomware rÃ©cent",
                    content: "J'ai rÃ©cemment analysÃ© un nouveau ransomware qui utilise des techniques sophistiquÃ©es : 1. Chiffrement hybride AES+RSA 2. Obfuscation du code 3. DÃ©tection de sandbox 4. Persistance via registre...",
                    author: "MalwareAnalyst",
                    category: "malware",
                    tags: ["ransomware", "malware", "analyse"],
                    createdAt: Date.now() - 518400000, // 6 days ago
                    views: 267,
                    likes: 41,
                    replies: 52,
                    likedBy: {}
                },
                {
                    title: "AES vs RSA : Quand utiliser quoi ?",
                    content: "Beaucoup confondent AES et RSA. Voici quand utiliser chaque algorithme : AES pour le chiffrement symÃ©trique des donnÃ©es, RSA pour l'Ã©change de clÃ©s et signatures numÃ©riques...",
                    author: "CryptoExpert",
                    category: "cryptography",
                    tags: ["AES", "RSA", "chiffrement", "cryptographie"],
                    createdAt: Date.now() - 604800000, // 7 days ago
                    views: 145,
                    likes: 22,
                    replies: 38,
                    likedBy: {}
                },
                {
                    title: "Techniques de rÃ©cupÃ©ration de donnÃ©es effacÃ©es",
                    content: "La rÃ©cupÃ©ration forensique demande des mÃ©thodes spÃ©cifiques : 1. Analyse des mÃ©tadonnÃ©es 2. Reconstruction de fichiers 3. Carving de donnÃ©es 4. Timeline d'activitÃ©s...",
                    author: "ForensicsPro",
                    category: "forensics",
                    tags: ["forensics", "rÃ©cupÃ©ration", "donnÃ©es"],
                    createdAt: Date.now() - 691200000, // 8 days ago
                    views: 198,
                    likes: 18,
                    replies: 29,
                    likedBy: {}
                }
            ];

            // Add sample posts to Firebase if they don't exist
            samplePosts.forEach((post, index) => {
                const postId = `sample_${post.category}_${index}`;
                database.ref(`posts/${postId}`).once('value').then((snapshot) => {
                    if (!snapshot.exists()) {
                        database.ref(`posts/${postId}`).set(post).then(() => {
                            console.log(`âœ… Sample post created: ${post.title}`);
                        });
                    }
                });
            });
        }

        // Initialize Enhanced Features on Page Load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸš€ Initializing Enhanced Doomsday Forums...');
            
            try {
                // Initialize all enhanced features
                initializeEnhancedFeatures();
                initializePerformanceMonitoring();
                
                // Update existing functions to use enhanced features
                if (typeof updateUserInterface === 'function') {
                    const originalUpdateUserInterface = updateUserInterface;
                    updateUserInterface = function() {
                        originalUpdateUserInterface();
                        updateUserInterfaceEnhanced();
                    };
                }
                
                // Replace showNotification with enhanced version
                if (typeof showNotification === 'function') {
                    const originalShowNotification = showNotification;
                    showNotification = function(message, type = 'info') {
                        showEnhancedToast(message, type);
                    };
                }
                
                // Add forum section ID for smooth scrolling
                const discussionSection = document.querySelector('.discussion-section');
                if (discussionSection) {
                    discussionSection.id = 'forums';
                }
                
                console.log('âœ… Enhanced Doomsday Forums initialized successfully');
                showEnhancedToast('Doomsday Forums chargÃ© avec succÃ¨s!', 'success', 2000);
                
            } catch (error) {
                handleEnhancedError(error, 'Enhanced Initialization');
            }
        });
        
        // Global error handler
        window.addEventListener('error', (event) => {
            handleEnhancedError(event.error, 'Global Error Handler');
        });
        
        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', (event) => {
            handleEnhancedError(event.reason, 'Unhandled Promise Rejection');
        });
        
        console.log('âœ… All enhanced systems ready');
    </script>
</body>
</html>
